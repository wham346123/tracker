let y,re=null,x=null,H=null,X=null,R=null,Y=null,N={};async function L(){const t=await U({action:"getAllSettings"});if("settings"in t)return t.settings;throw new Error("Failed to retrieve settings.")}async function be(t){const n=await U({action:"updateSettings",data:t});if("settings"in n)return n.settings;throw new Error("Failed to update settings.")}function U(t){return new Promise((n,e)=>{try{chrome.runtime.sendMessage(t,s=>{const o=chrome.runtime.lastError;if(o){if(o.message?.includes("Extension context invalidated")){console.warn("Extension context invalidated, forcing page reload..."),window.location.reload();return}e(new Error(o.message||"Unknown error occurred"));return}n(s)})}catch(s){if(s instanceof Error&&s.message.includes("Extension context invalidated")){console.warn("Extension context invalidated (caught), forcing page reload..."),window.location.reload();return}e(s)}})}function oe(t){let n,e=.5;switch(t){case"buy":n=y?.soundEffects?.buySound,e=y?.soundEffects?.buyVolume??.5;break;case"sell":n=y?.soundEffects?.sellSound,e=y?.soundEffects?.sellVolume??.5;break;case"consolidate":n=y?.soundEffects?.consolidateSound,e=y?.soundEffects?.consolidateVolume??.5;break;case"split":n=y?.soundEffects?.splitSound,e=y?.soundEffects?.splitVolume??.5;break}if(n&&n!=="off"&&n!=="none"){const s=`/assets/media/sound_effects/${n}.mp3`,o=new Audio(chrome.runtime.getURL(s));o.volume=e,o.play().catch(r=>{console.error("Failed to play sound effect:",r)})}}async function V(t,n,e,s,o,r,i,a){const c=await U({action:"sendBuyOrder",data:{enabledWallets:t,lp:n,tokenAddress:e,buyAmount:s,buyFee:o,buyTip:r,slippagePercent:i,forceStaticTip:a}});if("success"in c){if(c.success)return oe("buy"),c.txids;throw new Error(c?.error||"Buy order failed.")}throw new Error("Invalid buy response")}async function ve(t,n,e,s,o,r,i){const a=await U({action:"sendSellOrder",data:{enabledWallets:t,lp:n,tokenAddress:e,sellPercent:s,sellFee:o,sellTip:r,slippagePercent:i}});if("success"in a){if(a.success)return oe("sell"),a.txids;throw new Error(a?.error||"Sell order failed.")}throw new Error("Invalid sell response")}async function je(t,n){const e=await U({action:"sendSplitRequest",data:{enabledWallets:t,tokenAddress:n}});if("success"in e){if(e.success)return oe("split"),e.txids;throw new Error(e?.error||"Split failed.")}throw new Error("Invalid split response")}async function De(t,n){const e=await U({action:"sendConsolidateRequest",data:{enabledWallets:t,tokenAddress:n}});if("success"in e){if(e.success)return oe("consolidate"),e.txids;throw new Error(e?.error||"Split failed.")}throw new Error("Invalid split response")}async function Z(t){const n=await L(),e=[];if(t&&t.length>0){if(n.platforms.photon.features.multiWallet)e.push(...t);else{if(n.wallets.length===0)throw new Error("No wallets found");for(const s of n.wallets)e.push(s.publicKey)}if(e.length===0)return;ce(null,e)}}async function ee(t){window.postMessage({type:"shitter-txids",txids:t},"*")}function ce(t,n){console.log("Setting PNL",t),window.postMessage({type:"photon",pl:t,newWallets:n},"*")}function f(t,n){window.postMessage({type:"shitter-toast",message:t,isError:n},"*")}function Oe(){const t=document.createElement("script");t.type="text/javascript",t.src=chrome.runtime.getURL("contentScripts/photon/txid-inject.js"),(document.head||document.documentElement).appendChild(t)}async function O(){const n=await(await fetch("https://photon-sol.tinyastro.io/sol_balance",{credentials:"include",headers:{Accept:"*/*","Cache-Control":"no-cache"},referrer:"https://photon-sol.tinyastro.io/en/memescope",method:"GET",mode:"cors"})).json();console.log("Refreshing balances",n);const e=document.querySelectorAll(".js-generated-balance");if(e.length===0){console.error("Failed to find balance elements");return}const s=n.solBalance;e.forEach(o=>{o.textContent=s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:4})}),Object.entries(n.balances).forEach(([o,r])=>{const i=r.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:4}),a=document.querySelector(`.js-header__balances__item[data-wallet="${o}"]`);if(!a)return;const c=a.querySelector('[data-key="value"]');c&&(c.textContent=i)})}async function Ke(t,n){const e=[];let s=0;const o=50;for(;;){let r=`https://photon-sol.tinyastro.io/api/lp/events?old_pool=false&order_by=timestamp&order_dir=desc&pool_id=${t}&size=${o}&offset=${s}&signer=${n.join(",")}`;N?.show&&(N.show["pump-pool_id"]?r+=`&pump_pool_id=${N.show["pump-pool_id"]}`:N.show["rl-pool-id"]?r+=`&pump_pool_id=${N.show["rl-pool-id"]}`:N.show["mvc-pool-id"]?r+=`&pump_pool_id=${N.show["mvc-pool-id"]}`:N.show["boop-pool-id"]&&(r+=`&pump_pool_id=${N.show["boop-pool-id"]}`));const a=await(await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}})).json();if(a.events.data.length===0||(e.push(...a.events.data),a.events.allEvents))break;s+=o}return e}async function Se(){try{const t=await L(),n=[];n.push(...xe()),n.push(...t.wallets.map(r=>r.publicKey));const e=Array.from(new Set(n)),s=document.querySelector("#js-page-config")?.dataset.showPoolId;if(!s){console.error("Failed to get pool ID");return}const o=await Ke(s,e);o.length!==0&&ce(o,n),j("update")}catch(t){console.warn("Failed to refresh PNL:",t)}}async function j(t="init"){const n=document.querySelector(".js-generated-balance"),e=n?.textContent&&parseFloat(n.textContent)||0,s=document.querySelector(".sol-price"),o=s?.textContent?parseFloat(s.textContent.replace(/[$,]/g,""))||window.solUsdPrice||200:window.solUsdPrice||200;let r=null;try{const i=localStorage.getItem("pnl-tracker-data");r=i?JSON.parse(i):null}catch{r=null}if(t==="update"){const i=document.getElementById("live-pnl-tracker");if(!i)return null;if(!r)return localStorage.removeItem("pnl-tracker-data"),i.remove(),setTimeout(async()=>await j("create"),100),null;const a=e*o,c=e-r.initialSolBalance,p=c*o,l=i.querySelector("#sol-balance"),u=i.querySelector("#usd-balance"),d=i.querySelector("#sol-pnl"),m=i.querySelector("#usd-pnl");return l&&(l.textContent=e.toFixed(2)),u&&(u.textContent=a.toFixed(2)),d&&(d.textContent=`${c>=0?"+":""}${c.toFixed(2)}`,d.className=`pnl-value pnl-change${c>0?" positive":c<0?" negative":""}`),m&&(m.textContent=`${p>=0?"+":""}${p.toFixed(2)}`,m.className=`pnl-value pnl-change${p>0?" positive":p<0?" negative":""}`),i}if(t==="init")return L().then(i=>{i?.platforms?.photon?.features?.livePnlTracker?.enabled&&(setTimeout(async()=>await j("create"),1e3),setInterval(async()=>await j("update"),2e3))}).catch(i=>{console.error("Failed to initialize PNL tracker:",i)}),null;if(t==="create"){const i=await L();let a=i?.platforms?.photon?.features?.livePnlTracker?.showDollarAmounts??!0,c=i?.platforms?.photon?.features?.livePnlTracker?.showSolAmounts??!0;!a&&!c&&(a=!0,c=!0),document.getElementById("live-pnl-tracker")?.remove(),r||(r={initialSolBalance:e,initialUsdBalance:e*o,startTime:Date.now()},localStorage.setItem("pnl-tracker-data",JSON.stringify(r)));let l;try{const T=localStorage.getItem("pnl-tracker-position");l=T?JSON.parse(T):{x:20,y:20,width:300,height:90}}catch{l={x:20,y:20,width:300,height:90}}const u=e*o,d=e-r.initialSolBalance,m=d*o,h=d>=0?"positive":"negative",w=m>=0?"positive":"negative",k=d>=0?"+":"",b=m>=0?"+":"",g=document.createElement("div");g.id="live-pnl-tracker",g.style.left=`${l.x}px`,g.style.top=`${l.y}px`,g.style.width=`${l.width||300}px`,g.style.height=`${l.height||90}px`,g.style.opacity=(i?.platforms?.photon?.features?.livePnlTracker?.opacity??1).toString();const q=[];c&&q.push(`
                <div class="pnl-item">
                    <img src="https://photon-sol.tinyastro.io/assets/icons/sol-d6ecfc05903dc1848872e95eab3de8cdbdeb68927d14e9d1dcf5d16212d65f74.svg" alt="SOL" class="sol-icon">
                    <span class="pnl-value" id="sol-balance">${e.toFixed(2)}</span>
                </div>
            `),a&&q.push(`
                <div class="pnl-item">
                    <span class="dollar-icon">$</span>
                    <span class="pnl-value" id="usd-balance">${u.toFixed(2)}</span>
                </div>
            `);const B=[];c&&B.push(`
                <div class="pnl-item">
                    <img src="https://photon-sol.tinyastro.io/assets/icons/sol-d6ecfc05903dc1848872e95eab3de8cdbdeb68927d14e9d1dcf5d16212d65f74.svg" alt="SOL" class="sol-icon">
                    <span class="pnl-value pnl-change ${h}" id="sol-pnl">${k}${d.toFixed(2)}</span>
                </div>
            `),a&&B.push(`
                <div class="pnl-item">
                    <span class="dollar-icon">$</span>
                    <span class="pnl-value pnl-change ${w}" id="usd-pnl">${b}${m.toFixed(2)}</span>
                </div>
            `),g.innerHTML=`
            <div class="pnl-header">
                <span class="pnl-title">shitter.<span style="background: linear-gradient(135deg, #0066FF, #4D9AFF); -webkit-background-clip: text; background-clip: text; color: transparent;">tech</span></span>
                <div class="pnl-controls">
                    <button class="pnl-reset" title="Reset PNL Data">⟲</button>
                    <button class="pnl-close" title="Close">×</button>
                </div>
            </div>
            <div class="pnl-content">
                ${q.length>0?`
                <div class="pnl-section">
                    <div class="pnl-section-title">Balance</div>
                    <div class="pnl-values">
                        ${q.join("")}
                    </div>
                </div>
                `:""}
                ${q.length>0&&B.length>0?'<div class="pnl-separator"></div>':""}
                ${B.length>0?`
                <div class="pnl-section">
                    <div class="pnl-section-title">P&L</div>
                    <div class="pnl-values">
                        ${B.join("")}
                    </div>
                </div>
                `:""}
            </div>
            <div class="pnl-resize-handle"></div>
        `;let S=!1,E=!1;const P={x:0,y:0},C={x:0,y:0,width:0,height:0};g.addEventListener("mousedown",T=>{const _=T.target;if(_?.classList.contains("pnl-close")||_?.classList.contains("pnl-reset"))return;if(_?.classList.contains("pnl-resize-handle")){E=!0;const z=g.getBoundingClientRect();C.x=T.clientX,C.y=T.clientY,C.width=z.width,C.height=z.height,T.preventDefault(),T.stopPropagation();return}S=!0,g.classList.add("dragging");const G=g.getBoundingClientRect();P.x=T.clientX-G.left,P.y=T.clientY-G.top,T.preventDefault()}),document.addEventListener("mousemove",T=>{if(E){const _e=T.clientX-C.x,Ae=T.clientY-C.y,ne=Math.max(120,Math.min(500,C.width+_e)),se=Math.max(60,Math.min(150,C.height+Ae));g.style.width=`${ne}px`,g.style.height=`${se}px`;const Ne=300,Ie=90,me=ne/Ne,fe=se/Ie,$e=Math.min(me,fe),Fe=Math.max(.8,Math.min(1.3,$e));g.style.setProperty("--scale-factor",Fe.toString()),g.style.setProperty("--width-ratio",me.toString()),g.style.setProperty("--height-ratio",fe.toString());const Me=JSON.parse(localStorage.getItem("pnl-tracker-position")||"{}");localStorage.setItem("pnl-tracker-position",JSON.stringify({...Me,width:ne,height:se}));return}if(!S)return;const _=T.clientX-P.x,G=T.clientY-P.y,z=window.innerWidth-g.offsetWidth,Te=window.innerHeight-g.offsetHeight,ue=Math.max(0,Math.min(z,_)),pe=Math.max(0,Math.min(Te,G));g.style.left=`${ue}px`,g.style.top=`${pe}px`,g.style.right="auto";const Pe=JSON.parse(localStorage.getItem("pnl-tracker-position")||"{}");localStorage.setItem("pnl-tracker-position",JSON.stringify({...Pe,x:ue,y:pe}))}),document.addEventListener("mouseup",()=>{S&&(S=!1,g.classList.remove("dragging")),E&&(E=!1)}),g.querySelector(".pnl-reset")?.addEventListener("click",async T=>{T.stopPropagation(),localStorage.removeItem("pnl-tracker-data"),g.remove(),setTimeout(async()=>await j("create"),100)}),g.querySelector(".pnl-close")?.addEventListener("click",async T=>{T.stopPropagation(),g.remove();const _=await L();be({platforms:{..._.platforms,photon:{..._.platforms.photon,features:{..._.platforms.photon.features,livePnlTracker:{enabled:!1,opacity:_.platforms.photon.features.livePnlTracker.opacity,showDollarAmounts:_.platforms.photon.features.livePnlTracker.showDollarAmounts,showSolAmounts:_.platforms.photon.features.livePnlTracker.showSolAmounts}}}}})});const I=300,$=90,M=(l.width||300)/I,D=(l.height||90)/$,v=Math.min(M,D),A=Math.max(.8,Math.min(1.3,v));return g.style.setProperty("--scale-factor",A.toString()),g.style.setProperty("--width-ratio",M.toString()),g.style.setProperty("--height-ratio",D.toString()),document.body.appendChild(g),g}return null}async function J(){re&&(console.log("Resetting PNL timer"),clearTimeout(re)),re=setTimeout(()=>{Se()},3e3)}async function We(){const t=()=>{const n=document.querySelector(".c-header__item.u-d-inline-flex-lg.u-d-none.u-mr-xs-md.u-mr-m-xl.js-intro");n&&n.remove();const e=document.querySelector(".p-dashboard__title");e&&(e.innerHTML='shitter.<span style="background: linear-gradient(135deg, #0066FF, #4D9AFF); -webkit-background-clip: text; background-clip: text; color: transparent;">tech</span>');const s=document.querySelector(".p-dashboard__subtitle");if(s&&s.parentNode){const o=s.cloneNode(!0);o.textContent="",s.parentNode.replaceChild(o,s)}return!!e};try{t()}catch(n){console.error("Error in removeTrash:",n)}}async function ke(t,n){const e=n==="USD"?"https://www.okx.com/api/v5/market/ticker?instId=SOL-USDT":"https://www.okx.com/api/v5/market/ticker?instId=SOL-EUR";if(X!==null&&(clearInterval(X),X=null),H=null,!t){if(x){const l=x.querySelector(".main-sol-price"),u=x.querySelector(".sol-icon"),d=x.querySelector(".sol-price-divider");l&&l.remove(),u&&u.remove(),d&&d.remove(),x.children.length===0&&(x.remove(),x=null)}return}const s=document.querySelector(".u-d-flex.u-align-items-center.u-justify-content-end");if(!s)return;x||(x=document.createElement("div"),x.className="sol-price-indicator",x.style.cssText="order: -1;",x.innerHTML='<div class="sol-price-content"></div>',s.appendChild(x));const o=x.querySelector(".sol-price-content");if(!o)return;if(!o.querySelector(".main-sol-price")){const l=document.createElement("img");l.src="https://photon-sol.tinyastro.io/assets/icons/sol-d6ecfc05903dc1848872e95eab3de8cdbdeb68927d14e9d1dcf5d16212d65f74.svg",l.alt="SOL",l.className="sol-icon",l.style.cssText="width: 16px; height: 16px; opacity: 0.85; flex-shrink: 0;";const u=document.createElement("span");if(u.className="sol-price main-sol-price",u.textContent="$0.00",o.appendChild(l),o.appendChild(u),o.querySelector(".sol-price-migration")){const d=document.createElement("span");d.className="sol-price-divider",d.textContent="|",o.insertBefore(d,o.querySelector(".sol-price-migration"))}}H=o.querySelector(".main-sol-price");let r=0;const i=(l,u)=>{const d=u==="EUR"?l*.92:l;return new Intl.NumberFormat("en-US",{style:"currency",currency:u,minimumFractionDigits:2,maximumFractionDigits:2}).format(d)},a=(l,u,d)=>{l&&(u>d?(l.classList.remove("price-down"),l.classList.add("price-up")):u<d&&(l.classList.remove("price-up"),l.classList.add("price-down")),setTimeout(()=>l.classList.remove("price-up","price-down"),600))},c=l=>{H&&(H.textContent=i(l,n),a(H,l,r)),r=l},p=async()=>{try{const u=await(await fetch(e)).json(),d=u?.data?.[0]?.last?parseFloat(u.data[0].last):0;d>0&&c(d)}catch(l){console.error("Error fetching SOL price:",l)}};await p(),X=window.setInterval(p,3e4)}async function Ee(t,n){const s=(await L()).platforms.photon.cleanup.migrationIndicator.currency,r='<img src="https://photon-sol.tinyastro.io/assets/pump-045f4b7aabe5dff1e2a9030448611760f6bd84d3e2669a20d7df7828b0febccc.png" alt="Pump.fun" style="width: 14px; height: 14px; margin-right: 4px; vertical-align: -2px;" />';if(Y!==null&&(clearInterval(Y),Y=null),R=null,!t){if(x){const d=x.querySelector(".sol-price-migration"),m=x.querySelector(".sol-price-divider");d&&d.remove(),m&&m.remove(),x.children.length===0&&(x.remove(),x=null)}return}const i=document.querySelector(".u-d-flex.u-align-items-center.u-justify-content-end");if(!i)return;x||(x=document.createElement("div"),x.className="sol-price-indicator",x.style.cssText="order: -1;",x.innerHTML='<div class="sol-price-content"></div>',i.appendChild(x));const a=x.querySelector(".sol-price-content");if(!a)return;if(!a.querySelector(".sol-price-migration")){if(a.querySelector(".main-sol-price")&&!a.querySelector(".sol-price-divider")){const m=document.createElement("span");m.className="sol-price-divider",m.textContent="|",a.appendChild(m)}const d=document.createElement("span");d.className="sol-price sol-price-migration",d.title="Pump.fun Migration Indicator",d.innerHTML=`${r}$0.00`,a.appendChild(d)}R=a.querySelector(".sol-price-migration");let c=0;const p=(d,m,h)=>{d&&(m>h?(d.classList.remove("price-down"),d.classList.add("price-up")):m<h&&(d.classList.remove("price-up"),d.classList.add("price-down")),setTimeout(()=>d.classList.remove("price-up","price-down"),600))},l=d=>{if(R){const m=Math.floor(d*410);R.innerHTML=`${r}${new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:0}).format(m)}`,p(R,d,c)}c=d},u=async()=>{try{const h=await(await fetch(n==="USD"?"https://www.okx.com/api/v5/market/ticker?instId=SOL-USDT":"https://www.okx.com/api/v5/market/ticker?instId=SOL-EUR")).json(),w=h?.data?.[0]?.last?parseFloat(h.data[0].last):0;w>0&&l(w)}catch(d){console.error("Error fetching SOL price for migration indicator:",d)}};await u(),Y=window.setInterval(u,3e4)}async function he(){document.querySelectorAll(".BrvKK0ZdmnUqsgnQHhMl").forEach(n=>{if(!(n instanceof HTMLElement)||n.dataset.processedByShitter)return;n.dataset.processedByShitter="true";const s=n.querySelectorAll(".js-copy-to-clipboard")[1].dataset.address;if(!s)return;const o=n.querySelector("a");if(!o)return;const r=o.getAttribute("href"),i=n.querySelector(".c-btn.c-btn--lt.u-px-xs");i&&(F(n),K(n),de(i,r,s))})}async function Ue(){console.log("[shitter.tech] Handling wallet tracker"),new MutationObserver(n=>{for(const e of n)e.addedNodes.forEach(s=>{s instanceof HTMLElement&&s.matches(".BrvKK0ZdmnUqsgnQHhMl")&&setTimeout(()=>{he()},200)})}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{he()},1e3)}async function He(){console.log("[shitter.tech] Handling clipboard row");const t=document.querySelector(".c-header__cb.js-header__cb");if(!t){console.error("Clipboard row not found");return}const n=t.querySelector(".js-header__cb__btn");if(!n){console.error("Buy button not found in clipboard row");return}const e=n.cloneNode(!0);n.parentNode?.replaceChild(e,n),e.onclick=async s=>{s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();try{const o=await L(),r=e.dataset?.wallets?.split(",");if(!r||r.length===0){f("No wallets selected",!0);return}const i=t.querySelector(".js-header__cb__val")?.textContent;if(!i){f("Failed to get buy amount",!0);return}console.log("Buy amount value:",i);const a=parseFloat(i)/r.length;if(isNaN(a)){f("Invalid buy amount",!0);return}const c=t.querySelector("a"),p=c?c.getAttribute("href"):null;if(!p){f("Failed to get coin pool",!0);return}const l=p.split("/")[5].split("?")[0],u=await navigator.clipboard.readText();if(!u){f("Failed to get token address from clipboard",!0);return}console.log(`Buying ${a} SOL worth of ${u} on ${r.length} wallets`),await V(r,l,u,a,o.transactions.presets[o.transactions.activePreset].quickBuyFee,o.transactions.presets[o.transactions.activePreset].quickBuyTip,o.transactions.presets[o.transactions.activePreset].quickBuySlippage,o.transactions.presets[o.transactions.activePreset].quickBuyUseStaticTip),setTimeout(()=>{O()},3e3),f(`Bought in with ${a} SOL`,!1),console.log("Pending pool",l),await chrome.storage.local.set({pendingPool:l}),o.platforms.photon.features.autoOpenChart.enabled&&setTimeout(()=>{if(o.platforms.photon.features.autoOpenChart.focusTab)window.open(p,"_blank");else{const d=document.createElement("a");d.href=p,d.rel="noopener noreferrer",d.dispatchEvent(new MouseEvent("click",{ctrlKey:!0,metaKey:!0}))}},o.platforms.photon.features.autoOpenChart.delay)}catch(o){const r=o.message||"An unknown error occurred";f(r,!0)}}}function W(){const t=document.querySelector(".p-settings__wallets__dd");if(!t)return[];const n=t.querySelectorAll(".js-wdd__item");return Array.from(n).filter(e=>{const s=e.querySelector('input[type="checkbox"]');return s instanceof HTMLInputElement&&s.checked}).map(e=>e.getAttribute("data-wallet")).filter(e=>e!==null)}function xe(){const t=document.querySelector(".p-settings__wallets__dd");if(!t)return f("Unable to find multiwallet dropdown",!0),[];const n=t.querySelectorAll(".js-wdd__item");return Array.from(n).map(e=>e.getAttribute("data-wallet"))}async function Re(){console.log("[shitter.tech] Handling memescope");const t=document.createElement("script");t.async=!1,t.src=chrome.runtime.getURL("contentScripts/photon/w-inject.js"),t.onload=()=>t.remove(),document.head.appendChild(t);const n=setInterval(async()=>{document.querySelector(".c-dropdown.c-wdd.c-wdd--inline-xl")?.parentElement&&(clearInterval(n),await ie(),await Be())},1e3);document.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(e=>{te(e)}),Le(),ze()}async function Q(){const t=document.querySelector(".shitter-toggle"),n=document.querySelector(".l-col.l-col-auto-lg.l-col-xl .u-d-flex.u-align-items-center.u-justify-content-end");if(!n){setTimeout(Q,100);return}if(t)return;const e=document.createElement("button");e.className="shitter-toggle",e.setAttribute("role","switch"),e.setAttribute("title","shitter.tech"),e.setAttribute("data-tooltip","shitter.tech");const s=document.createElement("div");s.className="shitter-toggle-track";const o=document.createElement("div");o.className="shitter-toggle-status",o.innerHTML='<span class="on">ON</span><span class="off">OFF</span>';const r=document.createElement("div");r.className="shitter-toggle-thumb",s.append(o,r),e.appendChild(s),(await L()).platforms.photon.features.shitterToggle.transactionsEnabled?e.classList.add("enabled"):e.classList.remove("enabled"),e.addEventListener("click",async d=>{d.preventDefault(),d.stopPropagation();const m=e.classList.contains("enabled");m?(e.classList.remove("enabled"),f("shitter.tech transactions disabled",!1)):(e.classList.add("enabled"),f("shitter.tech transactions enabled",!1));const h=await L();be({platforms:{...h.platforms,photon:{...h.platforms.photon,features:{...h.platforms.photon.features,shitterToggle:{...h.platforms.photon.features.shitterToggle,transactionsEnabled:!m}}}}})});const c=document.createElement("div");c.className="u-d-flex u-align-items-center u-mr-xs u-mr-s-md",c.id="shitter-toggle-container",c.style.cssText="display: flex; align-items: center; gap: 8px; order: -2;";const p=document.createElement("div");p.className="shitter-logo-container";const l=document.createElement("img");l.className="shitter-logo",l.src=chrome.runtime.getURL("assets/media/logos/icon-128.png"),l.alt="Shitter",l.setAttribute("draggable","false"),l.addEventListener("dragstart",d=>d.preventDefault()),p.appendChild(l),c.appendChild(p),c.appendChild(e);const u=document.createElement("div");u.className="shitter-separator",c.appendChild(u),n.insertBefore(c,n.firstChild)}async function ae(t){const e=(await L()).platforms.photon.features.quickBuyPresets,s=[{enabled:e.affectGraduated,label:"Graduated"},{enabled:e.affectGraduating,label:"Graduating"},{enabled:e.affectNew,label:"New"}],o=[];s.forEach(({enabled:r,label:i})=>{if(!r)return;Array.from(document.querySelectorAll(".G3nWYwyOTPi2QhQqDOSG")).forEach(c=>{if(c.textContent?.trim()===i){const p=c.closest(".l-row.u-align-items-center.l-row-gap--xxs.u-position-static");if(p){const l=p.querySelectorAll(".c-field__input.c-indx-filters__field__input");o.push(...Array.from(l))}}})}),o.length!==0&&o.forEach(r=>{r.value=t.toString(),r.dispatchEvent(new Event("input",{bubbles:!0}))})}async function ie(){try{const t=await L(),n=t.platforms.photon.features.quickBuyPresets,e=document.querySelector(".shitter-quick-buttons");if(!n?.enabled){e?.remove();return}const s=document.querySelector(".c-dropdown.c-wdd.c-wdd--inline-xl")?.parentElement;if(!s)return;const o=n.amounts||[];let r=e;r||(r=document.createElement("div"),r.className="l-col-12 l-col-lg-auto u-d-flex u-align-items-center shitter-quick-buttons",r.style.cssText="margin: 0 8px; display: flex; gap: 6px;",s.parentNode?.appendChild(r)),r.innerHTML="";const i=(a,c)=>{const p=document.createElement("button");p.className="quick-preset-btn",p.style.position="relative";const l=t.keybinds[c];let u="";if(l){const m=l.primary?.toLowerCase()||"",h=l.secondary||"",w={control:"Ctrl",ctrl:"Ctrl",alt:"Alt",shift:"Shift",cmd:"Cmd",meta:"Cmd"},k=[];Object.keys(w).forEach(b=>{m.includes(b)&&k.push(w[b])}),k.length>0&&h?u=`${k.join(" + ")} + ${h}`:m&&!w[m]?u=m:h&&(u=h)}p.dataset.tooltip=u?`Preset ${c+1} (${u})`:`Preset ${c+1}`;const d=document.createElement("img");return d.src="https://photon-sol.tinyastro.io/assets/icons/sol-d6ecfc05903dc1848872e95eab3de8cdbdeb68927d14e9d1dcf5d16212d65f74.svg",d.alt="SOL",d.style.flexShrink="0",p.append(d,document.createTextNode(a.toString())),p.addEventListener("click",async()=>await ae(a)),p};o.forEach((a,c)=>{const p=Number(a);if(Number.isFinite(p)&&p>0){const l=i(a,c);r.appendChild(l)}})}catch(t){console.error("Error creating quick buy buttons:",t)}}async function Ce(){const t=async e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;const s=await L(),r=s.platforms.photon.features.quickBuyPresets.amounts,i=[];e.ctrlKey&&i.push("Ctrl"),e.altKey&&i.push("Alt"),e.shiftKey&&i.push("Shift"),e.metaKey&&i.push("Cmd");let a=e.key;a.length===1&&(a=a.toLowerCase()),console.log("Key pressed:",a,"Modifiers:",i),s.keybinds.forEach((p,l)=>{if(l<5&&p.primary&&r[l]){const u=i.some(m=>p.primary.includes(m));if(p.primary===a||u){if(p.secondary&&!(p.secondary===a))return;console.log(`Triggering quick buy preset ${l+1} for keybind`),e.preventDefault(),e.stopPropagation(),ae(r[l])}}});const c=s.keybinds[5];if(c&&c.primary){const p=i.some(d=>c.primary.includes(d)),l=c.primary===a;let u=!0;if(c.secondary&&(u=c.secondary===a),(l||p)&&u){e.preventDefault(),e.stopPropagation(),await Q();const d=document.querySelector(".shitter-toggle");d&&d.click()}}},n=async e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;const s=await L(),r=s.platforms.photon.features.quickBuyPresets.amounts,i=[];e.ctrlKey&&i.push("Ctrl"),e.altKey&&i.push("Alt"),e.shiftKey&&i.push("Shift"),e.metaKey&&i.push("Cmd");const a=`M${e.button}`;s.keybinds.forEach((p,l)=>{if(l<5&&p.primary&&r[l]){const u=i.some(m=>p.primary.includes(m));if(p.primary===a||u){if(p.secondary&&!(p.secondary===a))return;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),ae(r[l])}}});const c=s.keybinds[5];if(c&&c.primary){const p=i.some(d=>c.primary.includes(d)),l=c.primary===a;let u=!0;if(c.secondary&&(u=c.secondary===a),(l||p)&&u){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),await Q();const d=document.querySelector(".shitter-toggle");d&&d.click()}}};document.removeEventListener("keydown",t),document.addEventListener("keydown",t),document.removeEventListener("mouseup",n),document.addEventListener("mouseup",n)}async function Je(){const t=window.location.href.split("/")[5].split("?")[0];console.log(`[shitter.tech] Handling pool ${t} page`),Oe();const n=document.createElement("script");n.async=!1,n.src=chrome.runtime.getURL("contentScripts/photon/pl-inject.js"),n.onload=()=>n.remove(),document.head.appendChild(n),y.platforms.photon.features.quickSwap&&(await ge(),qe()),Le(),new MutationObserver(async u=>{for(const d of u)if(d.type==="childList")for(const m of Array.from(d.addedNodes)){if(m.nodeType!==Node.ELEMENT_NODE)continue;const h=m;h.classList&&h.classList.contains("js-price-form__item")&&await ge()}}).observe(document.body,{childList:!0,subtree:!0});const s=document.querySelector(".js-buy-btn.js-show__trade-form__submit"),o=document.querySelector(".js-copy-to-clipboard")?.getAttribute("data-address");if(!o){f("Failed to initialize pool page",!0);return}if(!await ye(o)){const u=setInterval(async()=>{await ye(o)&&clearInterval(u)},1e4)}s&&(s.onclick=async u=>{if(!y.platforms.photon.features.shitterToggle.transactionsEnabled)return;u.preventDefault(),u.stopPropagation();const m=s.querySelector(".js-buy-btn__amount")?.textContent?.trim();if(!m){f("Invalid buy amount",!0);return}console.log(`Buying ${m} SOL worth of ${o}`);const h=document.querySelector('[data-name="priority"][data-strategy-type="buy"]'),w=document.querySelector('[data-name="bribery"][data-strategy-type="buy"]');if(!h||!w){f("Failed to find fee settings",!0);return}const k=document.querySelector('[data-preset-type="buy"] input[name="slippage"]');if(!k){f("Failed to find slippage settings",!0);return}const b=parseFloat(h.value),g=parseFloat(w.value),q=parseFloat(m),B=parseFloat(k.value);if(isNaN(q)){f("Invalid buy amount",!0);return}const S=W();if(S.length===0){f("No wallets enabled",!0);return}try{const E=await V(S,t,o,q/S.length,b,g,B);ee(E),Z(S),J(),setTimeout(()=>{O()},3e3),f(`Bought in with ${q} SOL`,!1)}catch(E){const P=E.message||"An unknown error occurred";f(P,!0)}});const r=document.querySelector(".js-sell-btn.js-show__trade-form__submit");if(!r){f("Failed to find sell button",!0);return}const i=r.parentElement;if(!i){f("Failed to get sell button parent",!0);return}r.onclick=async u=>{if(!y.platforms.photon.features.shitterToggle.transactionsEnabled)return;u.preventDefault(),u.stopPropagation();let d=i.querySelector(".js-price-form__btn.is-selected")?.getAttribute("data-value")??"";if(!d){const S=i.querySelector(".c-field__input.js-price-form__input");if(!S){f("Sell input not found",!0);return}d=S.value}if(!d){f("Invalid sell %",!0);return}console.log(`Selling ${d}% of ${o}`);const m=document.querySelector('[data-name="priority"][data-strategy-type="sell"]'),h=document.querySelector('[data-name="bribery"][data-strategy-type="sell"]');if(!m||!h){f("Failed to find fee settings",!0);return}const w=parseFloat(m.value),k=parseFloat(h.value),b=parseInt(d,10);if(isNaN(b)){f("Invalid sell percentage",!0);return}const g=document.querySelector('[data-preset-type="sell"] input[name="slippage"]');if(!g){f("Failed to find slippage settings",!0);return}const q=parseFloat(g.value),B=W();try{const S=await ve(B,t,o,b,w,k,q);ee(S),Z(B),J(),setTimeout(()=>{O()},3e3),f(`Sold ${b}%`,!1)}catch(S){const E=S.message||"An unknown error occurred";f(E,!0)}};const a=document.querySelector(".l-row.p-show__bar__row.u-align-items-center"),c=document.createElement("div");c.classList.add("l-col-md-auto","l-col-12","u-d-flex"),c.innerHTML=`
      <div class="c-w-form__settings__switch1 u-d-flex u-align-items-center u-flex-nowrap">
        <div class="u-mr-xxs u-color-dark u-font-light-semibold">Confirmed</div>
        <label class="c-switch">
          <input class="c-switch__input js-settings__commitment" name="chart_processed" type="checkbox" />
          <span class="c-switch__slider"></span>
        </label>
        <div class="u-ml-xxs u-color-dark u-font-light-semibold">Processed</div>
      </div>
    `;const p=c.querySelector(".c-switch__input.js-settings__commitment"),l=await chrome.storage.local.get("commitmentConfirmed");p.checked=l?.commitmentConfirmed??!0,p.addEventListener("change",async function(){await chrome.storage.local.set({commitmentConfirmed:this.checked});const u=document.head.querySelector('meta[name="csrf-token"]');fetch("https://photon-sol.tinyastro.io/api/users/update_commitment_level",{headers:{"content-type":"application/json","x-csrf-token":u?.content??""},body:`{"confirmed":${this.checked}}`,method:"POST"}).then(async d=>{console.log(await d.json()),location.reload()}).catch(d=>{console.error("Failed to update commitment level",d)})}),a&&a.children.length>0&&a.insertBefore(c,a.children[1]);try{const u=await L(),d=[];d.push(...u.wallets.map(h=>h.publicKey)),d.push(...xe());const m=Array.from(new Set(d));ce(null,m)}catch(u){console.warn("Failed to get settings in handlePoolPage:",u)}}function qe(){console.log("[shitter.tech] Applying quick swap styles");const t=document.querySelector(".js-fpf-popup.c-fpf__container");if(!t)return;const n=document.querySelector(".c-dropdown.js-dropdown.js-wdd.c-wdd");if(!n||!n.parentNode){console.error("Wallet dropdown not found or parent node is missing");return}const e=n.querySelector(".c-wdd__wallets");e&&e.classList.add("shitter-wallet-text");let s=n.parentElement?.querySelector(".autobuy_input-toggle"),o=n.parentElement,r=!1;const i=new Set,a=n.querySelectorAll(".c-checkbox__input"),c=()=>{chrome.storage.sync.get(["walletDropdownToggled"],b=>{r=b.walletDropdownToggled===!0,s&&p(r)})},p=b=>{s&&s.classList.toggle("active",b)},l=()=>{r=!r,r?(i.clear(),a.forEach(b=>{if(b.checked){const g=b.closest(".js-wdd__item")?.getAttribute("data-wallet");g&&i.add(g)}}),a.forEach(b=>{b.checked=!0,b.dispatchEvent(new Event("change",{bubbles:!0})),b.nextElementSibling&&b.nextElementSibling.classList.add("is-checked")})):a.forEach(b=>{const g=b.closest(".js-wdd__item")?.getAttribute("data-wallet"),q=g?i.has(g):!1;b.checked=q,b.dispatchEvent(new Event("change",{bubbles:!0})),b.nextElementSibling&&b.nextElementSibling.classList.toggle("is-checked",q)}),chrome.storage.sync.set({walletDropdownToggled:r}),p(r)};if(!s){const b=document.createElement("div");b.className="shitter-wallet-wrapper",n.parentNode.insertBefore(b,n),b.appendChild(n),o=b,s=document.createElement("button"),s.className="autobuy_input-toggle shitter-toggle-btn",s.innerHTML=`
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        `,c(),s.addEventListener("click",g=>{g.stopPropagation(),l()}),o.appendChild(s)}const u=t.querySelector(".c-fpf"),d=t.querySelector(".c-fpf__handle"),m=u?.querySelector(".shitter-extra-wrapper"),{quickSwap:h,quickSwapTools:w,quickSwapWallets:k}=y.platforms.photon.features;if(h){if(t.classList.add("styled"),d&&(d.classList.add("styled"),d.querySelector(".shitter-tech-label")||(d.innerHTML='<span class="shitter-tech-label">shitter.<span class="tech-part">tech</span></span>')),!k&&s&&o&&(s.remove(),o!==n.parentElement&&o.replaceWith(n)),!w){const g=document.querySelector("#shitter-split-btn"),q=document.querySelector("#shitter-revert-btn");g&&g.remove(),q&&q.remove()}const b=t.querySelector(".c-fpf__header h2");if(w&&b&&!document.querySelector("#shitter-split-btn")){const g=document.createElement("div");g.className="shitter-button-container";const q="shitter-action-btn",B=document.createElement("button");B.id="shitter-split-btn";const S=document.createElement("img");S.src=chrome.runtime.getURL("/assets/media/icons/split.png"),S.alt="Split",S.className="shitter-btn-icon",B.appendChild(S),B.className=q,B.title="Split supply",B.addEventListener("click",async()=>{const C=W();if(C.length<=1){f("Select at least 2 wallets for splitting",!0);return}const I=document.querySelector(".js-copy-to-clipboard")?.getAttribute("data-address");if(!I){f("Failed to get token address",!0);return}try{(await je(C,I)).length!==0?f("Split transactions sent",!1):f("No supply to split",!0)}catch($){const M=$.message||"An unknown error occurred";f(M,!0)}});const E=document.createElement("button");E.id="shitter-revert-btn";const P=document.createElement("img");P.src=chrome.runtime.getURL("/assets/media/icons/consolidate.png"),P.alt="Consolidate",P.className="shitter-btn-icon",E.appendChild(P),E.className=q,E.title="Revert split supply",E.addEventListener("click",async()=>{const C=W();if(C.length<=1){f("Select at least 2 wallets for consolidating",!0);return}const I=document.querySelector(".js-copy-to-clipboard")?.getAttribute("data-address");if(!I){f("Failed to get token address",!0);return}try{(await De(C,I)).length!==0?f("Consolidate transactions sent",!1):f("No supply to consolidate",!0)}catch($){const M=$.message||"An unknown error occurred";f(M,!0)}}),g.appendChild(B),g.appendChild(E),b.classList.add("shitter-header-flex"),b.appendChild(g)}}else t.classList.remove("styled"),d&&(d.classList.remove("styled"),d.textContent="Quick Swap"),m&&m.remove(),s&&o&&o!==n.parentElement&&(s.remove(),o.replaceWith(n))}async function ge(){Array.from(document.querySelectorAll(".c-btn.c-fpf__button.u-px-s.js-fpf__button")).forEach(n=>{n.dataset.shitterInjected!=="true"&&(n.addEventListener("click",async e=>{if(!y.platforms.photon.features.shitterToggle.transactionsEnabled)return;e.preventDefault(),e.stopPropagation();const s=n.getAttribute("data-type");if(!s)return;const o=document.querySelector(".js-copy-to-clipboard")?.getAttribute("data-address");if(!o){f("Failed to get token address",!0);return}const r=W();if(r.length===0){f("No wallets enabled",!0);return}const i=window.location.href.split("/")[5].split("?")[0];if(s==="buy"){const a=parseFloat(n.getAttribute("data-value")??"");if(isNaN(a)){f("Invalid buy amount",!0);return}const c=document.querySelector('[data-name="priority"][data-strategy-type="buy"]'),p=document.querySelector('[data-name="bribery"][data-strategy-type="buy"]'),l=parseFloat(c?.value??""),u=parseFloat(p?.value??"");if(isNaN(l)||isNaN(u)){f("Failed to get fee settings",!0);return}const d=document.querySelector('[data-preset-type="buy"] input[name="slippage"]');if(!d){f("Failed to find slippage settings",!0);return}const m=parseFloat(d.value);try{const h=await V(r,i,o,a,l,u,m);ee(h),Z(r),J(),setTimeout(()=>{O()},3e3),f(`Bought in with ${a} SOL`,!1)}catch(h){const w=h.message.slice(0,100)||"An unknown error occurred";f(w,!0)}}else if(s==="sell"){const a=parseFloat(n.getAttribute("data-value")??"");if(isNaN(a)){f("Invalid sell percentage",!0);return}const c=document.querySelector('[data-name="priority"][data-strategy-type="sell"]'),p=document.querySelector('[data-name="bribery"][data-strategy-type="sell"]'),l=parseFloat(c?.value??""),u=parseFloat(p?.value??"");if(isNaN(l)||isNaN(u)){f("Failed to get fee settings",!0);return}const d=document.querySelector('[data-preset-type="sell"] input[name="slippage"]');if(!d){f("Failed to find slippage settings",!0);return}const m=parseFloat(d.value);try{const h=await ve(r,i,o,a,l,u,m);ee(h),Z(r),J(),setTimeout(()=>{O()},3e3),f(`Sold ${a}%`,!1)}catch(h){const w=h.message.slice(0,100)||"An unknown error occurred";f(w,!0)}}}),n.dataset.shitterInjected="true")})}function K(t,n=0){if(!y||!t)return;const e=t.querySelector(".D05u1bw1k0YiV6GK94gQ, .MvgAnm_Zn0svGB199DTB");if(!e){n<5&&setTimeout(()=>K(t,n+1),100);return}if(e.classList.remove("styled","expanded"),["palette-blue","palette-purple","palette-green","palette-amber","palette-rose"].forEach(o=>e.classList.remove(o)),e.style.removeProperty("--custom-color"),e.style.removeProperty("--border-radius"),e.style.removeProperty("--border-width"),y.platforms.photon.buttons.expandSocialIcons.enabled?(e.style.setProperty("--icon-size",`${y.platforms.photon.buttons.expandSocialIcons.width}px`),e.classList.add("expanded")):(e.style.removeProperty("--icon-size"),e.classList.remove("expanded")),y.platforms.photon.buttons.styleSocialIcons.enabled){e.classList.add("styled");const o=y.platforms.photon.buttons.styleSocialIcons.palette,{borderRadius:r,borderWidth:i}=y.platforms.photon.buttons.styleSocialIcons;if(e.style.setProperty("--border-radius",`${r}px`),e.style.setProperty("--border-width",`${i}px`),y.customColors&&y.customColors.includes(o)){const c=o;e.style.setProperty("--custom-color",c),e.querySelectorAll("a").forEach(l=>{l.style.borderColor=`${c}33 !important`,l.style.color=`${c} !important`;const u=`custom-hover-${Date.now()}-${Math.random()}`;l.setAttribute("data-hover-id",u);const d=h=>{const w=h.target;w.getAttribute("data-hover-id")===u&&(w.style.borderColor=`${c}66 !important`,w.style.color=`${c} !important`,w.style.boxShadow=`0 0 0 1px ${c}1a !important`)},m=h=>{const w=h.target;w.getAttribute("data-hover-id")===u&&(w.style.borderColor=`${c}33 !important`,w.style.color=`${c} !important`,w.style.boxShadow="none !important")};l.addEventListener("mouseenter",d),l.addEventListener("mouseleave",m)})}else e.classList.add(`palette-${o}`)}}function F(t,n=0){if(!y)return;const e=t.querySelector(".blacklist-overlay");e&&e.remove(),t.style.display="";let s=t.querySelector('[data-tooltip-content="Website"]');if(!s){const r=t.querySelectorAll(".IrSOk2x9Sg3QrXngRC6Q");s=Array.from(r).find(i=>i.querySelector('span[data-icon="website"]')!==null)||null}if(!s){n<3&&setTimeout(()=>F(t,n+1),100);return}const o=s.href;if(o&&y.platforms.photon.cleanup.blacklistedSites.length)try{let r=o.toLowerCase();if(r=r.replace(/^(https?:\/\/)?(www\.)?/,"").split("/")[0],y.platforms.photon.cleanup.blacklistedSites.some(a=>{const c=a.toLowerCase().replace(/^(https?:\/\/)?(www\.)?/,"").split("/")[0];return r.includes(c)}))if(y.platforms.photon.cleanup.blacklistAction==="hide")t.hidden=!0;else{t.style.position||(t.style.position="relative");const a=document.createElement("div");a.className="blacklist-overlay",a.textContent="Site Blacklisted",t.appendChild(a)}}catch(r){console.error("[shitter.tech] Error checking blacklisted domain:",r)}}async function de(t,n,e){le(t),t.onclick=async s=>{if(!y.platforms.photon.features.shitterToggle.transactionsEnabled)return;s.preventDefault(),s.stopPropagation();const o=await L(),r=document.querySelector(".c-wdd__wallets.text-ellipsis.js-wdd__wallets")?.textContent?.split(", ");if(!r){f("Failed to get enabled wallets",!0);return}const{genWallets:i}=await chrome.storage.local.get("genWallets");if(!i){f("Failed to get wallets",!0);return}const a=i.filter(l=>r.includes(l.name)).map(l=>l.generated_wallet),c=parseFloat(t.textContent||"")/a.length;if(isNaN(c)){f("Invalid buy amount",!0);return}const p=n.split("/")[3].split("?")[0];console.log(`Buying ${t.textContent} SOL worth of ${e} on ${a.length} wallets`);try{await V(a,p,e,c,o.transactions.presets[o.transactions.activePreset].quickBuyFee,o.transactions.presets[o.transactions.activePreset].quickBuyTip,o.transactions.presets[o.transactions.activePreset].quickBuySlippage,o.transactions.presets[o.transactions.activePreset].quickBuyUseStaticTip),setTimeout(()=>{O()},3e3),f(`Bought in with ${c} SOL`,!1),console.log("Pending pool",p),await chrome.storage.local.set({pendingPool:p}),o.platforms.photon.features.autoOpenChart.enabled&&(t.dataset.chartOpened||(t.dataset.chartOpened="true",setTimeout(()=>{if(o.platforms.photon.features.autoOpenChart.focusTab)window.open(n,"_blank");else{const l=document.createElement("a");l.href=n,l.rel="noopener noreferrer",l.dispatchEvent(new MouseEvent("click",{ctrlKey:!0,metaKey:!0}))}},o.platforms.photon.features.autoOpenChart.delay)))}catch(l){const u=l.message||"An unknown error occurred";f(u,!0)}}}async function Be(){const n=(await L())?.platforms?.photon?.features?.autoBuy?.enabled,e=document.querySelector(".autobuy-toggle-container");if(!n){e&&e.remove();return}if(!e){const s=document.querySelector(".c-dropdown.c-wdd.c-wdd--inline-xl")?.parentElement;if(s){const o=document.createElement("div");o.className="autobuy-toggle-container l-col-12 u-mt-m u-mt-0-xl l-col-xl-auto hide-m";const r=document.createElement("button");r.className="autobuy-toggle-button",r.innerHTML=`
                    <svg class="autobuy-zap-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"></polygon>
                    </svg>
                `;const i=document.createElement("div");i.className="autobuy-input-field",i.innerHTML=`
                    <input type="text" class="autobuy-keyword-input" placeholder="Auto buy Ticker / Name / CA" />
                `,o.appendChild(r),o.appendChild(i);let a=!1;r.addEventListener("click",()=>{a=!a,r.classList.toggle("active",a),i.classList.toggle("expanded",a)}),s.parentNode?.appendChild(o)}}}async function Qe(t,n){const e=t.querySelector(".text-ellipsis.js-copy-to-clipboard"),s=e?.parentElement?.previousSibling;if(!e||!s)return;const o=e.textContent?.toLowerCase(),r=s.textContent?.toLowerCase();if(!o||!r)return;const i=t.querySelector(".js-copy-to-clipboard")?.getAttribute("data-address")?.toLowerCase(),a=document.querySelector(".autobuy-keyword-input"),c=(a?.value||"").trim().toLowerCase();if(c.length===0)return;const l=(t.querySelector(".u-font-light-semibold.u-color-dark")?.textContent||"").trim().toLowerCase(),d=new Set(["-1d","just now","1s","2s"]).has(l),h=t.querySelector('[data-tooltip-content="Volume"]')?.nextElementSibling?.textContent?.trim()||"",w=h==="$0"||h==="0",k=(q,B)=>{const S=q.toLowerCase(),E=B.startsWith("*"),P=B.endsWith("*");let C=B;return E&&(C=C.slice(1)),P&&(C=C.slice(0,-1)),E&&P?S.includes(C):E?S.endsWith(C):P?S.startsWith(C):S===C};(k(o,c)||k(r,c)||i&&k(i,c))&&(d||w)&&(n.click(),a.value="")}function te(t){if(t.dataset.processedByShitter==="true")return;t.dataset.processedByShitter="true",F(t);const n=t.querySelector(".c-btn.c-btn--lt");if(!n)return;const e=t.querySelector(".js-copy-to-clipboard")?.getAttribute("data-address");if(!e){console.error("Failed to get token address");return}const s=t.querySelector("a"),o=s?s.getAttribute("href"):null;if(!o){f("Failed to get coin pool",!0);return}t.addEventListener("contextmenu",i=>{i.preventDefault(),i.stopPropagation();const a=`https://photon-sol.tinyastro.io${o}`;window.open(a,"_blank","noopener,noreferrer")}),setTimeout(()=>{const i=t.querySelectorAll(".IrSOk2x9Sg3QrXngRC6Q"),a=Array.from(i).find(c=>c.querySelector('span[data-icon="website"]'));if(a){const c=a.getAttribute("href");if(!c)return;try{const p=new URL(c).hostname;a.removeAttribute("data-tooltip-id"),a.removeAttribute("data-tooltip-content"),a.removeAttribute("title");const l=document.createElement("div");l.className="shitter-custom-tooltip",l.textContent=p,l.style.cssText=`
      position: fixed;            /* viewport-relative */
      background: #000;
      color: #fff;
      padding: 7px 11px;
      border-radius: 6px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 100000;            /* big to beat local stacking contexts */
      pointer-events: none;
      display: none;
      transform: translateX(-50%);
    `,t.appendChild(l);let u=!1;const d=()=>{const b=a.getBoundingClientRect();l.style.left=`${b.left+b.width/2}px`,l.style.top=`${Math.max(0,b.top-8-l.offsetHeight)}px`},m=()=>{u=!0,l.style.display="block",d()},h=()=>{u=!1,l.style.display="none"},w=()=>{u&&d()};a.addEventListener("mouseenter",m),a.addEventListener("mouseleave",h),window.addEventListener("scroll",w,{passive:!0}),window.addEventListener("resize",w);const k=new MutationObserver(()=>{(!t.isConnected||!a.isConnected)&&(a.removeEventListener("mouseenter",m),a.removeEventListener("mouseleave",h),window.removeEventListener("scroll",w),window.removeEventListener("resize",w),k.disconnect(),l.remove())});k.observe(document.body,{childList:!0,subtree:!0})}catch(p){console.error("Failed to parse URL for website icon:",c,p)}}},500),Ge(t),K(t),de(n,o,e),Qe(t,n);const r=t.querySelector(".MfRnDjSwkHsiSo8_tjRE.tu2KqRLZ08uIuwiRAyTA");r&&(r.onclick=i=>{i.stopPropagation(),i.preventDefault(),t.hidden=!0,chrome.storage.local.get(["hiddenTokens"],a=>{const c=a.hiddenTokens||[];c.includes(e)||(c.push(e),chrome.storage.local.set({hiddenTokens:c},()=>{console.log(`Token ${e} added to hidden list`),f("Token hidden successfully",!1)}))})},Ve(e).then(i=>{i&&(t.hidden=!0)}))}async function Ve(t){return new Promise(n=>{chrome.storage.local.get(["hiddenTokens"],e=>{let s=e.hiddenTokens||[];s.length>200&&(s=s.slice(-200),chrome.storage.local.set({hiddenTokens:s})),n(s.includes(t))})})}function le(t){if(!y)return;if(t.classList.remove("styled","expanded","glow"),["palette-blue","palette-purple","palette-green","palette-amber","palette-rose"].forEach(e=>t.classList.remove(e)),t.removeAttribute("style"),y.platforms.photon.buttons.styleBuyButton.enabled){t.classList.add("styled");const{palette:e,borderRadius:s,borderWidth:o,borderStyle:r,glowEffect:i}=y.platforms.photon.buttons.styleBuyButton;if(y.customColors&&y.customColors.includes(e)){const c=e,p=[`border-radius: ${s}px !important`,`border-width: ${o}px !important`,`border-style: ${r} !important`,`border-color: ${c}40 !important`];i?(t.classList.add("glow"),t.style.setProperty("--custom-glow-color",c)):(t.classList.remove("glow"),t.style.removeProperty("--custom-glow-color")),t.setAttribute("style",p.join(";")),t.addEventListener("mouseenter",()=>{t.style.borderColor=`${c}66 !important`}),t.addEventListener("mouseleave",()=>{t.style.borderColor=`${c}40 !important`})}else{t.classList.add(`palette-${e}`);const c=[`border-radius: ${s}px !important`,`border-width: ${o}px !important`,`border-style: ${r} !important`];i?t.classList.add("glow"):t.classList.remove("glow"),t.setAttribute("style",c.join(";"))}}if(y.platforms.photon.buttons.expandBuyButton.enabled){const e=t.querySelector(".u-w-100");e&&e.classList.remove("u-w-100"),t.classList.add("expanded");const s=t.getAttribute("style")||"",o=`width: ${y.platforms.photon.buttons.expandBuyButton.width}px !important;
            height: ${y.platforms.photon.buttons.expandBuyButton.height}px !important;
            max-width: ${y.platforms.photon.buttons.expandBuyButton.width}px !important;
            max-height: ${y.platforms.photon.buttons.expandBuyButton.height}px !important;`,i=`opacity: ${y.platforms.photon.buttons.expandBuyButton.opacity??1} !important;`;t.setAttribute("style",`${s};${o};${i}`)}}function Ge(t){y&&(y.platforms.photon.style.styleTokenCards?t.classList.add("styled"):t.classList.remove("styled"),y.platforms.photon.style.compactCards?t.classList.add("compact"):t.classList.remove("compact"))}window.addEventListener("message",async t=>{if(t.source===window&&t.data?.source==="shitter"){const n=t.data.genWalletsData;await chrome.storage.local.set({genWallets:n})}else if(t.data.type==="shitter-taconfig"){const{config:n,pool:e}=t.data.data,s=window.location.href.split("/")[5].split("?")[0];if(s!==e){console.log("Pool ID does not match, ignoring...",s,e);return}N=n;let o=!1;const r=await chrome.storage.local.get("pendingPool");if(r?.pendingPool){console.log("Pending pool found, clearing...",r);const i=r.pendingPool,a=window.location.href.split("/")[5].split("?")[0];i===a?(chrome.storage.local.remove("pendingPool"),o=!0):console.log("Pending pool ID does not match current pool ID, ignoring...",i,a)}else console.log("No pending pool found in storage");o?(console.log("Pending pool found, waiting for trades..."),J(),setTimeout(()=>{const i=document.createElement("script");i.src=chrome.runtime.getURL("contentScripts/photon/p-inject.js"),i.async=!1,i.onload=function(){this.remove()},(document.head||document.documentElement).prepend(i)},2e3)):(console.log("No pending pool, fetching trades..."),Se())}});function ze(){new MutationObserver(n=>{for(const e of n)e.type==="childList"&&e.addedNodes.forEach(s=>{if(s.nodeType!==Node.ELEMENT_NODE)return;const o=s;o.matches(".VTmpJ0jdbJuSJQ4HKGlN")&&te(o),o.matches(".BrvKK0ZdmnUqsgnQHhMl")&&F(o),o.matches(".sBVBv2HePq7qYTpGDmRM")&&(o.dataset.processedByShitter||we(o)),o.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(c=>{c.dataset.processedByShitter||te(c)}),o.querySelectorAll(".BrvKK0ZdmnUqsgnQHhMl").forEach(c=>{c.dataset.processedByShitter||F(c)}),o.querySelectorAll(".sBVBv2HePq7qYTpGDmRM").forEach(c=>{c.dataset.processedByShitter||we(c)})})}).observe(document.documentElement,{childList:!0,subtree:!0})}function ye(t){return new Promise(n=>{const e=document.querySelector(".p-show__widget.p-show__pair");if(!e||e.querySelector(".dexscreener-banner"))return n(!0);const s=`https://dd.dexscreener.com/ds-data/tokens/solana/${t}/header.png`,o=new Image;o.src=s+`?t=${Date.now()}`,o.onload=()=>{const r=document.createElement("div");r.className="dexscreener-banner",r.style.backgroundImage=`url('${s}')`,e.prepend(r),n(!0)},o.onerror=()=>n(!1)})}chrome.storage.onChanged.addListener(async t=>{if(y=await L(),t.soundEffects)return;let n=!1;try{const e=t.platforms?.oldValue??{},s=t.platforms?.newValue??{},o=e.photon||{},r=s.photon||{},i=o.features||{},a=r.features||{},c=o.cleanup||{},p=r.cleanup||{},l=o.buttons||{},u=r.buttons||{},d=i.solPriceIndicator||{},m=a.solPriceIndicator||{};(d.enabled!==m.enabled||d.currency!==m.currency)&&ke(m.enabled,m.currency);const h=c.migrationIndicator||{},w=p.migrationIndicator||{};if(h.enabled!==w.enabled||h.currency!==w.currency){const v=w.enabled,A=w.currency;Ee(v,A)}const k=l.expandSocialIcons||{},b=u.expandSocialIcons||{};(k.enabled!==b.enabled||k.width!==b.width||k.height!==b.height)&&(console.log("Updating social icons"),document.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(v=>{K(v)})),o.buttons&&o.buttons.expandBuyButton&&o.buttons.expandBuyButton!==r.buttons.expandBuyButton&&(console.log("Expanding buy buttons"),document.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(v=>{const A=v.querySelector(".c-btn.c-btn--lt");A&&le(A)}));const g=c.blacklistedSites||[],q=p.blacklistedSites||[];(g.length!==q.length||JSON.stringify([...g].sort())!==JSON.stringify([...q].sort())||c.blacklistAction!==p.blacklistAction)&&(console.log("Blacklist settings updated, refreshing all cards..."),document.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(v=>{F(v)}),document.querySelectorAll(".BrvKK0ZdmnUqsgnQHhMl").forEach(v=>{F(v)}),setTimeout(()=>{document.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(v=>{F(v)}),document.querySelectorAll(".BrvKK0ZdmnUqsgnQHhMl").forEach(v=>{F(v)})},500)),(i.quickSwap!==a.quickSwap||i.quickSwapTools!==a.quickSwapTools||i.quickSwapWallets!==a.quickSwapWallets)&&(n=!0);const S=i.livePnlTracker||{},E=a.livePnlTracker||{};if(S.enabled!==E.enabled){const v=document.getElementById("live-pnl-tracker");E.enabled&&!v?(setTimeout(()=>j("create"),100),setInterval(()=>j("update"),2e3)):!E.enabled&&v&&v.remove()}if(S.opacity!==E.opacity){const v=document.getElementById("live-pnl-tracker");v&&(v.style.opacity=(E.opacity??1).toString())}t.customColors&&(console.log("Custom colors updated, refreshing button and social icon styles"),document.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(v=>{const A=v.querySelector(".c-btn.c-btn--lt");A&&le(A),K(v)}),document.querySelectorAll(".BrvKK0ZdmnUqsgnQHhMl").forEach(v=>{K(v)}));const P=i.quickBuyPresets||{},C=a.quickBuyPresets||{};(P.enabled!==C.enabled||JSON.stringify(P.amounts)!==JSON.stringify(C.amounts))&&(console.log("Quick buy presets updated, refreshing..."),ie());const I=i.autoBuy||{},$=a.autoBuy||{};I.enabled!==$.enabled&&(console.log("Auto buy presets updated, refreshing..."),Be());const M=i.shitterToggle||!1,D=a.shitterToggle||!1;if(M!==D){console.log("Shitter toggle setting changed:",D);const v=document.querySelector(".shitter-toggle");D&&!v?await Q():!D&&v&&document.querySelector("#shitter-toggle-container")?.remove()}t.keybinds&&(console.log("Keybinds updated, refreshing quick buy presets..."),Ce(),ie())}catch(e){console.error("[shitter.tech] Error parsing settings changes:",e)}n&&qe()});function we(t){const n=t.querySelector(".WONu4jRBwJmFo3FD6XwP.c-btn.c-btn--lt");if(!n)return;const e=n.cloneNode(!0);if(n.parentNode)n.parentNode.replaceChild(e,n);else return;const s=t.querySelector(".js-copy-to-clipboard")?.getAttribute("data-address");if(!s)return;const o=t.querySelector("a")?.getAttribute("href");o&&(de(e,o,s),t.dataset.processedByShitter="true")}async function Le(){const t=await L();if(!t.platforms.photon.features.watchlistBuyButtons.enabled)return;const n=document.querySelectorAll(".js-watch-token");function e(s){return new Promise((o,r)=>{const i=document.createElement("iframe");i.style.display="none",console.log("Creating iframe for",s),setInterval(()=>{if(i.contentWindow){const a=i.contentWindow.location.href;a.includes("/lp/")&&(console.log(s,"Pool:",a),i.remove(),o(a))}},10),i.onload=()=>{try{if(console.log("Created iframe for",s),i.contentWindow){const a=i.contentWindow.location.href;o(a)}else r(new Error("iframe.contentWindow is null"))}catch{r(new Error("Final URL is cross-origin, cannot read it"))}finally{i.remove()}},i.onerror=()=>{r(new Error("Failed to load iframe")),i.remove()},i.src=s,document.body.appendChild(i)})}for(const s of n){if(!(s instanceof HTMLElement)||s.dataset.processedByShitter)continue;s.dataset.processedByShitter="true";const o=s.querySelector("a");if(!o){console.log("[shitter.tech] No link found in watch item");continue}try{const r=document.createElement("button");r.className="shitter-watchlist-buy-btn";const i=document.createElement("span");i.className="c-icon c-icon--net-symbol c-header__item__title__icon",r.appendChild(i),r.appendChild(document.createTextNode(` ${t.platforms.photon.features.watchlistBuyButtons.buyAmount}`)),r.addEventListener("click",async()=>{const c=await e(o.href),p=c.split("/")[5].split("?")[0],l=await L();let u=W();if(u.length===0){const h=document.querySelector(".c-wdd__wallets.text-ellipsis.js-wdd__wallets")?.textContent?.split(", ");if(!h){f("Failed to get enabled wallets",!0);return}const{genWallets:w}=await chrome.storage.local.get("genWallets");if(!w){f("Failed to get wallets",!0);return}u=w.filter(k=>h.includes(k.name)).map(k=>k.generated_wallet)}const d=l.platforms.photon.features.watchlistBuyButtons.buyAmount;if(isNaN(d)){f("Invalid buy amount",!0);return}const m="So11111111111111111111111111111111111111112";console.log(`Buying ${d} SOL worth of ${m} on ${u.length} wallets`);try{await V(u,p,m,d,l.transactions.presets[l.transactions.activePreset].quickBuyFee,l.transactions.presets[l.transactions.activePreset].quickBuyTip,l.transactions.presets[l.transactions.activePreset].quickBuySlippage,l.transactions.presets[l.transactions.activePreset].quickBuyUseStaticTip),setTimeout(()=>{O()},3e3),f(`Bought in with ${d} SOL`,!1),console.log("Pending pool",p),await chrome.storage.local.set({pendingPool:p}),l.platforms.photon.features.autoOpenChart.enabled&&(s.dataset.chartOpened||(s.dataset.chartOpened="true",setTimeout(()=>{if(l.platforms.photon.features.autoOpenChart.focusTab)window.open(c,"_blank");else{const h=document.createElement("a");h.href=c,h.rel="noopener noreferrer",h.dispatchEvent(new MouseEvent("click",{ctrlKey:!0,metaKey:!0}))}},l.platforms.photon.features.autoOpenChart.delay)))}catch(h){const w=h.message||"An unknown error occurred";f(w,!0)}});const a=s.querySelector(".js-mktcap-watch");a&&a.parentElement&&a.parentElement.appendChild(r)}catch(r){console.error("[shitter.tech] Error processing watch item:",r)}}}(async function(){try{y=await L(),y.platforms.photon.features.shitterToggle&&await Q(),y=await L();const t=y.platforms.photon.features.solPriceIndicator.enabled,n=y.platforms.photon.features.solPriceIndicator.currency,e=y.platforms.photon.cleanup.migrationIndicator.enabled,s=y.platforms.photon.cleanup.migrationIndicator.currency;ke(t,n),Ee(e,s),j("init"),document.querySelectorAll(".VTmpJ0jdbJuSJQ4HKGlN").forEach(o=>{te(o)}),window.location.href.includes("/en/lp/")?await Je():window.location.href.includes("memescope")?await Re():window.location.href.includes("wallets_tracking")&&await Ue(),await He(),await Ce(),await We()}catch(t){console.error("[shitter.tech] Error in init:",t)}})();
