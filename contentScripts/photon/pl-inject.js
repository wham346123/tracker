(function(){let w=[];window.addEventListener("message",i=>{if(i.data&&i.data.type==="photon"){const{newWallets:a,pl:s}=i.data;if(a&&(w=a),s){const o={};s.forEach(n=>{const{maker:t,type:l,quoteAmount:d,usdAmount:r,tokensAmount:p}=n.attributes;o[t]||(o[t]={investedEth:0,investedUsd:0,investedTokens:0,soldEth:0,soldUsd:0,soldTokens:0,remainingTokens:0,txsCount:0,remainingEth:0,remainingUsd:0,plEth:0,plUsd:0,pl:0,plUsdPerc:0,generatedWallet:t});const e=parseFloat(d)||0,c=parseFloat(r)||0,u=parseFloat(p)||0;l==="buy"?(o[t].investedEth+=e,o[t].investedUsd+=c,o[t].investedTokens+=u,o[t].txsCount++):l==="sell"&&(o[t].soldEth+=e,o[t].soldUsd+=c,o[t].soldTokens+=u,o[t].txsCount++)}),Object.keys(o).forEach(n=>{const t=o[n];t.remainingTokens=t.investedTokens-t.soldTokens,t.remainingEth=t.remainingTokens*parseFloat(document.querySelector("[data-cable-val='priceQuote']").dataset.value),t.remainingUsd=t.remainingEth*window.solUsdPrice,window._portfolioState.state.wallets[n]||(window._portfolioState.state.wallets[n]={pos:{}}),console.log(t),window._portfolioState.state.wallets[n].pos=t}),window._portfolioState.state.average=window._portfolioState.calculateAverage(),setTimeout(()=>{window._portfolioState.checkVisibility(),window._portfolioState.broadcastUpdate({action:"show"})},1e3)}}}),$(document).on("datafeed:append",function(i,a){if(Array.isArray(a))return;const{maker:s,type:o,quoteAmount:n,usdAmount:t,tokensAmount:l}=a.attributes;if(!w.includes(s))return;const d=parseFloat(n)||0,r=parseFloat(t)||0,p=parseFloat(l)||0;(!window._portfolioState.state.wallets[s]||!window._portfolioState.state.wallets[s].pos)&&(window._portfolioState.state.wallets[s]={pos:{investedEth:0,investedUsd:0,investedTokens:0,soldEth:0,soldUsd:0,soldTokens:0,remainingTokens:0,txsCount:0,remainingEth:0,remainingUsd:0,plEth:0,plUsd:0,pl:0,plUsdPerc:0,generatedWallet:s}});const e=window._portfolioState.state.wallets[s].pos;o==="buy"?(e.investedEth+=d,e.investedUsd+=r,e.investedTokens+=p,e.txsCount++):o==="sell"&&(e.soldEth+=d,e.soldUsd+=r,e.soldTokens+=p,e.txsCount++),e.remainingTokens=e.investedTokens-e.soldTokens,e.remainingEth=e.remainingTokens*parseFloat(document.querySelector("[data-cable-val='priceQuote']").dataset.value),e.remainingUsd=e.remainingEth*window.solUsdPrice,window._portfolioState.state.average=window._portfolioState.calculateAverage(),window._portfolioState.checkVisibility(),window._portfolioState.broadcastUpdate({action:"show"})})})();
