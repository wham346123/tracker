const F='[style*="position: absolute;"][style*="width: 100%;"][style*="left: 0px;"]';function I(t){return new Promise((e,n)=>{chrome.runtime.sendMessage(t,i=>{const s=chrome.runtime.lastError;if(s){if(s.message?.includes("Extension context invalidated")){console.warn("Extension context invalidated, reloading page..."),window.location.reload();return}n(new Error(s.message||"Unknown error occurred"));return}e(i)})})}function f(t,e){window.postMessage({type:"shitter-toast",message:t,isError:e},"*")}async function se(t){const e=await I({action:"updateSettings",data:t});if("settings"in e)return e.settings;throw new Error("Failed to update settings.")}async function w(){const t=await I({action:"getAllSettings"});if("settings"in t)return t.settings;throw new Error("Failed to retrieve settings.")}async function j(){const t=await w();if(t.platforms.axiom.features.multiWallet)return T;{const e=[];if(t.wallets.length===0)throw new Error("No wallets found in settings");for(const n of t.wallets)e.push(n.publicKey);return e}}function D(t){let e,n=.5;switch(t){case"buy":e=g?.soundEffects?.buySound,n=g?.soundEffects?.buyVolume??.5;break;case"sell":e=g?.soundEffects?.sellSound,n=g?.soundEffects?.sellVolume??.5;break;case"consolidate":e=g?.soundEffects?.consolidateSound,n=g?.soundEffects?.consolidateVolume??.5;break;case"split":e=g?.soundEffects?.splitSound,n=g?.soundEffects?.splitVolume??.5;break}if(e&&e!=="off"&&e!=="none"){const i=`/assets/media/sound_effects/${e}.mp3`,s=new Audio(chrome.runtime.getURL(i));s.volume=n,s.play().catch(c=>{console.error("Failed to play sound effect:",c)})}}async function R(t,e,n,i,s,c,a,l){const o=await I({action:"sendBuyOrder",data:{enabledWallets:t,lp:e,tokenAddress:n,buyAmount:i,buyFee:s,buyTip:c,slippagePercent:a,forceStaticTip:l}});if("success"in o){if(o.success)return D("buy"),o.txids;throw new Error(o?.error||"Buy order failed.")}throw new Error("Invalid buy response")}async function ce(t,e,n,i,s,c,a){const l=await I({action:"sendSellOrder",data:{enabledWallets:t,lp:e,tokenAddress:n,sellPercent:i,sellFee:s,sellTip:c,slippagePercent:a}});if("success"in l){if(l.success)return D("sell"),l.txids;throw new Error(l?.error||"Sell order failed.")}throw new Error("Invalid sell response")}async function le(t,e){const n=await I({action:"sendSplitRequest",data:{enabledWallets:t,tokenAddress:e}});if("success"in n){if(n.success)return D("split"),n.txids;throw new Error(n?.error||"Split failed.")}throw new Error("Invalid split response")}async function ue(t,e){const n=await I({action:"sendConsolidateRequest",data:{enabledWallets:t,tokenAddress:e}});if("success"in n){if(n.success)return D("consolidate"),n.txids;throw new Error(n?.error||"Split failed.")}throw new Error("Invalid split response")}let T=[],C={},S="";function de(){const t=document.createElement("script");t.type="text/javascript",t.src=chrome.runtime.getURL("contentScripts/axiom/s-inject.js"),(document.head||document.documentElement).appendChild(t)}window.addEventListener("message",async t=>{if(t.data.type==="shitter-axiom-settings"){const{wallets:e,solPresets:n,currentSolPresetKey:i}=t.data;try{T=e,C=n,S=i;const s=await w();s.platforms.axiom.features.presetsSupport&&(S==="preset1"||S==="preset2"||S==="preset3")&&(console.log("Syncing Shitter preset:",S),se({transactions:{...s.transactions,activePreset:S}}))}catch(s){console.error("Failed to process settings:",s),s instanceof Error&&s.message?.includes("Extension context invalidated")&&window.location.reload()}}});async function ne(t){let e;const i=Array.from(document.querySelectorAll("span")).find(r=>r.textContent?.trim()==="CA:");if(i){const r=i.nextElementSibling;if(r){const d=r?.textContent?.trim()?.split(".")[0];d&&(e=Array.from(k.values()).find(m=>m.tokenAddress.startsWith(d))?.tokenAddress)}}if(!e){const r=document.querySelector(".relative.w-\\[36px\\].h-\\[36px\\].justify-center");if(r){const u=await L(r);e=W(u,"tokenAddress")}}if(!e||typeof e!="string"){const r=document.querySelector('img.rounded-\\[1px\\].w-full.h-full.object-cover[src$=".webp"]');r&&(e=r?.src.match(/\/([A-Za-z0-9]{10,})\.webp$/)?.[1])}if(!e){f("Token address not found",!0);return}const s=window.location.pathname.split("/").filter(Boolean),c=s[s.length-1];if(console.log("Buy amount",t,"Token address",e,"LP",c),!C[S]){f("No preset found",!0);return}const a=parseFloat(C[S].buy.priorityFeeSol);if(isNaN(a)){f("Failed to get priority fee",!0);return}const l=parseFloat(C[S].buy.bribeFeeSol);if(isNaN(l)){f("Failed to get tip",!0);return}const o=parseFloat(C[S].buy.slippage);if(isNaN(o)){f("Failed to get slippage",!0);return}try{const r=await j();await R(r,c,e,t/r.length,a,l,o),f(`Bought in with ${t} SOL`,!1)}catch(r){const u=r.message||"An unknown error occurred";u.includes("Bonding curve is complete")?(f("Bonding curve is complete, refreshing page...",!0),window.location.reload()):f(u,!0)}}async function oe(t){let e;const i=Array.from(document.querySelectorAll("span")).find(r=>r.textContent?.trim()==="CA:");if(i){const r=i.nextElementSibling;if(r){const d=r?.textContent?.trim()?.split(".")[0];d&&(e=Array.from(k.values()).find(m=>m.tokenAddress.startsWith(d))?.tokenAddress)}}if(!e){const r=document.querySelector(".relative.w-\\[36px\\].h-\\[36px\\].justify-center");if(r){const u=await L(r);e=W(u,"tokenAddress")}}if(!e||typeof e!="string"){const r=document.querySelector('img.rounded-\\[1px\\].w-full.h-full.object-cover[src$=".webp"]');r&&(e=r?.src.match(/\/([A-Za-z0-9]{10,})\.webp$/)?.[1])}if(!e){f("Token address not found",!0);return}const s=window.location.pathname.split("/").filter(Boolean),c=s[s.length-1];if(console.log("Sell amount",t,"Token address",e,"LP",c),!C[S]){f("No preset found",!0);return}const a=parseFloat(C[S].sell.priorityFeeSol);if(isNaN(a)){f("Failed to get priority fee",!0);return}const l=parseFloat(C[S].sell.bribeFeeSol);if(isNaN(l)){f("Failed to get tip",!0);return}const o=parseFloat(C[S].sell.slippage);if(isNaN(o)){f("Failed to get slippage",!0);return}try{const r=await j();await ce(r,c,e,t,a,l,o),f(`Sold ${t}%`,!1)}catch(r){const u=r.message||"An unknown error occurred";u.includes("Bonding curve is complete")?(f("Bonding curve is complete, refreshing page...",!0),window.location.reload()):f(u,!0)}}async function V(t){const e=await w();if(t.dataset.processedByShitter)return;if(t.dataset.processedByShitter="true",console.log("Handling quick swap"),e.platforms.axiom.features.quickSwap){new MutationObserver(a=>{a.forEach(l=>{if(l.type==="attributes"&&l.attributeName==="class"){const o=l.target;console.log("Handling quick swap styled"),o.classList.contains("styled")||o.classList.add("styled")}})}).observe(t,{attributes:!0,attributeFilter:["class"]}),t.classList.add("styled");const c=t.querySelector(".bg-backgroundTertiary.border-b.border-secondaryStroke");if(c){const a=document.createElement("div");a.className="shitter-tech-container";const l=document.createElement("div");l.className="shitter-tech-label",l.innerHTML="shitter.<span>tech</span>",a.appendChild(l),c.appendChild(a)}}if(t.querySelectorAll('div[class*="border-increase"][class*="text-increase"]').forEach(s=>{s.dataset.processedByShitter||(s.dataset.processedByShitter="true",s.addEventListener("click",async c=>{if(!g.platforms.axiom.features.shitterToggle.transactionsEnabled)return;c.preventDefault(),c.stopImmediatePropagation();const a=parseFloat(s.textContent||"");if(isNaN(a)){t.querySelector('input[type="text"]')||f("Invalid buy amount",!0);return}await ne(a)}))}),t.querySelectorAll('div[class*="border-decrease"][class*="text-decrease"]').forEach(s=>{s.dataset.processedByShitter||(s.dataset.processedByShitter="true",s.addEventListener("click",async c=>{if(!g.platforms.axiom.features.shitterToggle.transactionsEnabled)return;c.preventDefault(),c.stopImmediatePropagation();const a=parseFloat(s.textContent||"");if(isNaN(a)){t.querySelector('input[type="text"]')||f("Invalid sell amount",!0);return}await oe(a)}))}),e.platforms.axiom.features.quickSwapTools){const s=t.querySelector(".flex.flex-col.gap-\\[12px\\]");if(!s){console.error("Row for button not found");return}if(s.dataset.processedByShitter)return;s.dataset.processedByShitter="true";const c=s.querySelector(".flex.items-center.justify-between");if(!c){console.error("Column for button not found");return}const a=t.querySelector(".ri-edit-line")?.closest("button")?.parentElement,l=c.querySelector(".text-\\[14px\\].leading-\\[18px\\].font-normal.text-textSecondary");if(a&&l&&l.parentElement){const m=t.querySelector(".bg-backgroundTertiary.border-b.border-secondaryStroke");m&&m.contains(a)&&(console.log("Moving edit button from header to buy section"),l.parentElement.appendChild(a))}else{const m=t.querySelector(".bg-backgroundTertiary.border-b.border-secondaryStroke .ri-edit-line")?.closest("button")?.parentElement;m&&l&&l.parentElement?(console.log("Moving edit button using fallback selector"),l.parentElement.appendChild(m)):console.log("Could not find edit button or buy text for moving")}c.classList.add("quick-swap-controls");const o=document.createElement("div");o.className="split-revert-container",o.style.cssText="display: flex; align-items: center; gap: 5px;";const r=document.createElement("button");r.className="quick-swap-split-button",r.title="Split supply",r.textContent="";const u=document.createElement("img");u.src=chrome.runtime.getURL("assets/media/icons/split.png"),u.alt="Split",u.className="split-icon",r.appendChild(u);const d=document.createElement("button");d.className="quick-swap-revert-button",d.title="Consolidate",d.textContent="";const p=document.createElement("img");if(p.src=chrome.runtime.getURL("assets/media/icons/consolidate.png"),p.alt="Consolidate",p.className="consolidate-icon",d.appendChild(p),r.addEventListener("click",async m=>{if(m.preventDefault(),m.stopImmediatePropagation(),T.length<=1){f("Select atleast 2 wallets for splitting",!0);return}let h;const x=Array.from(document.querySelectorAll("span")).find(y=>y.textContent?.trim()==="CA:");if(x){const y=x.nextElementSibling;if(y){const E=y?.textContent?.trim()?.split(".")[0];E&&(h=Array.from(k.values()).find(A=>A.tokenAddress.startsWith(E))?.tokenAddress)}}if(!h){const y=document.querySelector(".relative.w-\\[36px\\].h-\\[36px\\].justify-center");if(y){const b=await L(y);h=W(b,"tokenAddress")}}if(!h||typeof h!="string"){const y=document.querySelector('img.rounded-\\[1px\\].w-full.h-full.object-cover[src$=".webp"]');y&&(h=y?.src.match(/\/([A-Za-z0-9]{10,})\.webp$/)?.[1])}if(!h){f("Token address not found",!0);return}try{(await le(T,h)).length!==0?f("Split transactions sent",!1):f("No supply to split",!0)}catch(y){const b=y.message||"An unknown error occurred";f(b,!0)}}),d.addEventListener("click",async m=>{if(m.preventDefault(),m.stopImmediatePropagation(),T.length<=1){f("Select atleast 2 wallets for consolidating",!0);return}let h;const x=Array.from(document.querySelectorAll("span")).find(y=>y.textContent?.trim()==="CA:");if(x){const y=x.nextElementSibling;if(y){const E=y?.textContent?.trim()?.split(".")[0];E&&(h=Array.from(k.values()).find(A=>A.tokenAddress.startsWith(E))?.tokenAddress)}}if(!h){const y=document.querySelector(".relative.w-\\[36px\\].h-\\[36px\\].justify-center");if(y){const b=await L(y);h=W(b,"tokenAddress")}}if(!h||typeof h!="string"){const y=document.querySelector('img.rounded-\\[1px\\].w-full.h-full.object-cover[src$=".webp"]');y&&(h=y?.src.match(/\/([A-Za-z0-9]{10,})\.webp$/)?.[1])}if(!h){f("Token address not found",!0);return}try{(await ue(T,h)).length!==0?f("Consolidate transactions sent",!1):f("No supply to split",!0)}catch(y){const b=y.message||"An unknown error occurred";f(b,!0)}}),o.appendChild(r),o.appendChild(d),c){const m=c.querySelector(".flex.items-center.space-x-1");m&&m.parentNode&&(c.appendChild(m.parentNode),c.insertBefore(o,m.parentNode))}else console.error("Row for button not found")}}async function X(){const t=document.querySelector("button.items-center.rounded-full.flex.flex-1.flex-row.justify-center");if(t){if(t.dataset.processedByShitter)return;t.dataset.processedByShitter="true",t.addEventListener("click",async e=>{if(!g.platforms.axiom.features.shitterToggle.transactionsEnabled||t.textContent?.includes("Snipe "))return;const i=Array.from(document.querySelectorAll("button")).find(r=>r.textContent?.trim()==="Market")?.querySelector("div")??null;if(!i)return;if(!i.classList.contains("border-b-[2px]")){console.log("Skipping handling order buttons, not in market mode");return}const c=Array.from(document.querySelectorAll('input[placeholder="0.0"]'));if(c.length<1){f("Amount input not found",!0);return}const a=c[0],l=parseFloat(a.value);if(isNaN(l)){f("Invalid amount",!0);return}if(t.classList.contains("bg-increase"))e.preventDefault(),e.stopImmediatePropagation(),await ne(l);else{const r=a.closest(".bg-primaryStroke\\/50");if(!r){console.error("Input parent container not found");return}const u=r.querySelectorAll("span");if(!Array.from(u).some(p=>p?.textContent?.trim()==="%")){console.error("Not in % mode");return}e.preventDefault(),e.stopImmediatePropagation(),await oe(l)}})}}const k=new Map,fe=5e3;function z(t){for(const e of t)if(k.has(e.tokenAddress))k.set(e.tokenAddress,e);else if(k.set(e.tokenAddress,e),k.size>fe){console.log("Token map size exceeded, truncating");const n=k.keys().next().value;if(!n)continue;k.delete(n)}}window.addEventListener("message",async t=>{if(t.data.type==="shitter-xhr-intercept"){if(t.data.url.endsWith("axiom.trade/pulse")){const e=JSON.parse(t.data.data);z(e)}else if(t.data.url.includes("pair-info")){const e=JSON.parse(t.data.data);console.log("[XHR] new token",e),z([e])}}else if(t.data.type==="shitter-ws-intercept"){const e=JSON.parse(t.data.data);if(e.room==="update_pulse"){const n=e.content;z(n)}else if(e.room==="migrations"){const n=window.location.pathname.split("/").filter(Boolean),i=n[n.length-1];console.log("Migrations room:",e);const s=e.content.from;if(s!==i){console.log("Pool doesn't match, not overwriting",s,i);return}const c=e.content.to;window.history.pushState({id:"100"},"meme","/meme/"+c)}}});let g;function H(t){const e=g.platforms.axiom.buttons.expandBuyButton,n=g.platforms.axiom.buttons.expandSocialIcons,i=g.platforms.axiom.buttons.styleBuyButton,s=t.querySelector("div.absolute.sm\\:block");if(!s)return;const c=s.querySelectorAll("button"),a=t.querySelector(".flex.flex-row.flex-shrink-0.gap-\\[8px\\].justify-start.items-center");c.forEach(o=>{if(e.enabled){const r=[...o.classList].find(d=>d.startsWith("w-[")),u=[...o.classList].find(d=>d.startsWith("h-["));r&&o.classList.replace(r,"sht"+r),u&&o.classList.replace(u,"sht"+u),o.style.width=`${e.width}px`,o.style.height=`${e.height}px`,o.style.opacity=e.opacity?.toString()||""}else{o.style.width="",o.style.height="";const r=[...o.classList].find(d=>d.startsWith("shtw-[")),u=[...o.classList].find(d=>d.startsWith("shth-["));r&&o.classList.replace(r,r.substring(3)),u&&o.classList.replace(u,u.substring(3))}if(i.enabled){const{borderRadius:r,borderWidth:u,borderStyle:d}=i,p=[`border-radius: ${r}px !important`,`border-width: ${u}px !important`,`border-style: ${d} !important`],m=o.getAttribute("style")||"";o.setAttribute("style",`${m};${p.join(";")}`),o.classList.add("styled")}else{o.classList.remove("styled");const u=(o.getAttribute("style")||"").split(";").filter(d=>!d.includes("border-radius")&&!d.includes("border-width")&&!d.includes("border-style")).join(";");o.setAttribute("style",u)}}),n.enabled&&a?(a.classList.add("shitter-social-icon"),a.style.setProperty("--icon-size",`${n.width}px`)):a&&(a.classList.remove("shitter-social-icons"),a.style.removeProperty("--icon-size"));const l=g.platforms.axiom.buttons.styleSocialIcons;if(l.enabled&&a){a.classList.remove("styled"),["palette-blue","palette-purple","palette-green","palette-amber","palette-rose"].forEach(m=>a.classList.remove(m)),a.style.removeProperty("--custom-color"),a.style.removeProperty("--border-radius"),a.style.removeProperty("--border-width"),a.classList.add("styled");const r=l.palette,{borderRadius:u,borderWidth:d}=l;a.style.setProperty("--border-radius",`${u}px`),a.style.setProperty("--border-width",`${d}px`),g.customColors&&g.customColors.includes(r)?a.style.setProperty("--custom-color",r):a.classList.add(`palette-${r}`)}else a&&(a.classList.remove("styled"),["palette-blue","palette-purple","palette-green","palette-amber","palette-rose"].forEach(r=>a.classList.remove(r)),a.style.removeProperty("--border-radius"),a.style.removeProperty("--border-width"),a.style.removeProperty("--custom-color"))}async function re(t){const e=t.querySelector("div.absolute.sm\\:block");e&&t.dataset.processedByShitter!=="true"&&(t.dataset.processedByShitter="true",H(t),e.addEventListener("click",async n=>{if(!g.platforms.axiom.features.shitterToggle.transactionsEnabled)return;n.preventDefault(),n.stopImmediatePropagation();let i,s;if(!i||!s){const r=await L(t.children[0].children[0]);if(console.log(r),r&&typeof r=="object"&&r!==null){const u=r;if(u.children&&typeof u.children=="object"&&u.children!==null){const d=u.children;if(d.props&&typeof d.props=="object"&&d.props!==null){const p=d.props;if(p.row&&typeof p.row=="object"&&p.row!==null){const m=p.row;i=m.tokenAddress,s=m.pairAddress}else if(p.children&&typeof p.children=="object"&&p.children!==null){const m=p.children;if(m.props&&typeof m.props=="object"&&m.props!==null){const h=m.props;if(h.row&&typeof h.row=="object"&&h.row!==null){const v=h.row;i=v.tokenAddress,s=v.pairAddress,console.log("Found via grandrow")}}}}}}}if(!i){f("Token address not found",!0);return}if(!s){f("Token info not found",!0);return}const c=Array.from(document.querySelectorAll('input[placeholder="0.0"]'));let a;for(let r=c.length-1;r>=0;r--){const u=c[r];if(u.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING){a=u;break}}if(!a){f("Amount input not found",!0);return}const l=parseFloat(a.value);console.log("Processing buy for token:",i,s);const o=await w();try{const r=await j();if(await R(r,s,i,l/r.length,o.transactions.presets[o.transactions.activePreset].quickBuyFee,o.transactions.presets[o.transactions.activePreset].quickBuyTip,o.transactions.presets[o.transactions.activePreset].quickBuySlippage,o.transactions.presets[o.transactions.activePreset].quickBuyUseStaticTip),f(`Bought in with ${l} SOL`,!1),o.platforms.axiom.features.autoOpenChart.enabled){const u=`/meme/${s}`;t.dataset.chartOpened||(t.dataset.chartOpened="true",setTimeout(()=>{if(o.platforms.axiom.features.autoOpenChart.focusTab)window.open(u,"_blank");else{const d=document.createElement("a");d.href=u,d.rel="noopener noreferrer",d.dispatchEvent(new MouseEvent("click",{ctrlKey:!0,metaKey:!0}))}},o.platforms.axiom.features.autoOpenChart.delay))}}catch(r){const u=r.message||"An unknown error occurred";f(u,!0)}}),await me(t,e))}async function ae(){const t=document.querySelector(".flex-none.flex.flex-row.w-full.h-\\[32px\\].justify-start.items-center"),e=t?.querySelector("span.font-medium.text-textPrimary");if(!t||!e)return;const n=document.querySelector(".shitter-quick-buttons");n&&n.remove();const i=await w(),s=i.platforms.axiom.features.quickBuyPresets;if(!s?.enabled)return;const c=s.amounts||[],a=document.createElement("div");a.className="shitter-quick-buttons flex items-center gap-2",a.style.cssText="display: flex; align-items: center; gap: 8px; padding-left: 12px; padding-right: 12px;",e.style.display="flex",e.style.alignItems="center",e.appendChild(a),c.forEach((l,o)=>{const r=Number(l);if(Number.isFinite(r)&&r>0){const u=document.createElement("div");u.className="relative";const d=document.createElement("button");d.className="quick-preset-btn";const p=document.createElement("img");p.src="/images/sol-fill.svg",p.alt="SOL",p.style.cssText="flex-shrink: 0;",d.appendChild(p),d.appendChild(document.createTextNode(l.toString()));const m=i.keybinds[o];let h=`Preset ${o+1}`;if(m){const v=m.primary?.toLowerCase()||"",x=m.secondary||"",y={control:"Ctrl",ctrl:"Ctrl",alt:"Alt",shift:"Shift",cmd:"Cmd",meta:"Cmd"},b=[];for(const E in y)v.includes(E)&&b.push(y[E]);(b.length>0||x)&&(h+=" (",b.length>0&&(h+=b.join(" + "),x&&(h+=" + ")),x&&(h+=x),h+=")")}d.dataset.tooltip=h,u.appendChild(d),d.addEventListener("click",()=>Q(l)),a.appendChild(u)}})}async function Q(t){const e=[{label:"New Pairs",key:"affectNewPairs"},{label:"Final Stretch",key:"affectFinalStretch"},{label:"Migrated",key:"affectMigrated"}];function n(c){const a=Array.from(document.querySelectorAll("span.text-textPrimary.text-\\[16px\\].font-medium")).find(o=>o.textContent?.trim()===c);if(!a)return null;const l=a.closest("div.sticky.top-0");return l?l.querySelector('input[placeholder="0.0"]'):null}const s=(await w()).platforms.axiom.features.quickBuyPresets;e.forEach(({label:c,key:a})=>{if(!s[a])return;const l=n(c);l&&(l.value=t.toString(),l.dispatchEvent(new Event("input",{bubbles:!0})))})}async function pe(){const t=async n=>{if(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)return;let i="";n.ctrlKey?i="Ctrl":n.altKey?i="Alt":n.shiftKey?i="Shift":n.metaKey&&(i="Cmd");let s=n.key;s.length===1&&(s=s.toLowerCase());const c=await w(),l=c.platforms.axiom.features.quickBuyPresets.amounts;c.keybinds.forEach((r,u)=>{if(u<5&&r.secondary){const d=r.primary===i,p=r.secondary===s;if(d&&p){n.preventDefault(),n.stopPropagation(),console.log(`Triggering quick buy preset ${u+1} for keybind`),Q(l[u]);return}}});const o=c.keybinds[5];if(o&&o.primary){const r=o.primary===i,u=o.secondary===s;if(r&&u){n.preventDefault(),n.stopPropagation(),B(),console.log("Shitter Toggle activated");const d=document.querySelector(".shitter-toggle");d&&d.click()}}},e=async n=>{if(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)return;let i="";n.ctrlKey?i="Ctrl":n.altKey?i="Alt":n.shiftKey?i="Shift":n.metaKey&&(i="Cmd");const s=`M${n.button}`,c=await w(),l=c.platforms.axiom.features.quickBuyPresets.amounts;c.keybinds.forEach((r,u)=>{if(u<5&&r.secondary){const d=r.primary===i;if(r.secondary===s&&d){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),Q(l[u]);return}}});const o=c.keybinds[5];if(o&&o.primary){const r=o.primary===i;if(o.secondary===s&&r){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),B();const d=document.querySelector(".shitter-toggle");d&&d.click()}}};document.removeEventListener("keydown",t),document.addEventListener("keydown",t),document.removeEventListener("mouseup",e),document.addEventListener("mouseup",e)}async function me(t,e){const n=await L(t),i=await K(n,"row");if(!i)return;const s=i.tokenTicker,c=i.tokenName,a=i.tokenAddress;if(!s||!c)return;const l=document.querySelector(".autobuy-keyword-input"),o=(l?.value||"").trim().toLowerCase();if(o.length===0)return;const u=(t.querySelector(".text-primaryGreen.text-\\[14px\\].font-medium")?.textContent||"").trim().toLowerCase(),p=new Set(["0s","1s","2s"]).has(u),v=Array.from(t.querySelectorAll("span")).find(O=>O.textContent==="V")?.nextSibling?.textContent?.trim()||"",x=v==="$0"||v==="0",y=(O,A)=>{const $=O.toLowerCase(),U=A.startsWith("*"),_=A.endsWith("*");let P=A;return U&&(P=P.slice(1)),_&&(P=P.slice(0,-1)),U&&_?$.includes(P):U?$.endsWith(P):_?$.startsWith(P):$===P};(y(c,o)||y(s,o)||a&&y(a,o))&&(p||x)&&(e.click(),l.value="")}async function ie(){const e=(await w())?.platforms?.axiom?.features?.autoBuy?.enabled,n=document.querySelector(".autobuy-toggle-container");if(!e){n&&n.remove();return}if(!n){const i=document.querySelector(".flex-none.flex.flex-row.w-full.h-\\[32px\\].justify-start.items-center"),s=i?.querySelector("span.font-medium.text-textPrimary");if(!i||!s){console.log("Pulse header or title span not found, retrying..."),setTimeout(ie,100);return}const c=document.createElement("div");c.className="autobuy-toggle-container l-col-12 u-mt-m u-mt-0-xl l-col-xl-auto hide-m";const a=document.createElement("button");a.className="autobuy-toggle-button",a.innerHTML=`
                    <svg class="autobuy-zap-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"></polygon>
                    </svg>
                `;const l=document.createElement("div");l.className="autobuy-input-field",l.innerHTML=`
                    <input type="text" name="autobuy" class="autobuy-keyword-input" placeholder="Auto buy Ticker / Name / CA" />
                `,c.appendChild(a),c.appendChild(l);let o=!1;a.addEventListener("click",()=>{o=!o,a.classList.toggle("active",o),l.classList.toggle("expanded",o)}),s.style.display="flex",s.style.alignItems="center",s?.appendChild(c)}}async function B(){if(document.querySelector(".shitter-toggle"))return;const t=document.querySelector("button i.ri-search-2-line")?.closest("button")||document.querySelector("button.hidden.sm\\:flex.flex-shrink-0.whitespace-nowrap.border-primaryStroke"),e=document.querySelector('a[href^="/rewards"] button span');if(!t||!e||e?.textContent!=="Rewards"){setTimeout(B,100);return}const n=document.createElement("button");n.className="shitter-toggle",n.setAttribute("role","switch"),n.setAttribute("title","Quick toggle to turn on & off shitter tech");const i=document.createElement("div");i.className="shitter-toggle-track";const s=document.createElement("div");s.className="shitter-toggle-status",s.innerHTML='<span class="on">ON</span><span class="off">OFF</span>';const c=document.createElement("div");c.className="shitter-toggle-thumb",i.append(s,c),n.appendChild(i),(await w()).platforms.axiom.features.shitterToggle.transactionsEnabled?n.classList.add("enabled"):n.classList.remove("enabled"),n.addEventListener("click",async p=>{p.preventDefault(),p.stopPropagation();const m=n.classList.contains("enabled");m?(n.classList.remove("enabled"),f("shitter.tech transactions disabled",!1)):(n.classList.add("enabled"),f("shitter.tech transactions enabled",!1));const h=await w();await se({platforms:{...h.platforms,axiom:{...h.platforms.axiom,features:{...h.platforms.axiom.features,shitterToggle:{...h.platforms.axiom.features.shitterToggle,transactionsEnabled:!m}}}}})});const o=document.createElement("div");o.className="flex items-center",o.id="shitter-toggle-container",o.style.cssText="display: flex; align-items: center; gap: 8px;";const r=document.createElement("div");r.className="shitter-logo-container";const u=document.createElement("img");u.className="shitter-logo",u.src=chrome.runtime.getURL("assets/media/logos/shitter.svg"),u.alt="Shitter",r.appendChild(u);const d=document.createElement("div");d.className="shitter-separator",o.appendChild(r),o.appendChild(n),o.appendChild(d),t.parentNode?.insertBefore(o,t)}de();let q=null,N=null,M=null;function Y(){q&&(q.disconnect(),q=null),N&&(N.disconnect(),N=null),M&&(M.disconnect(),M=null)}async function Z(){if(new URLSearchParams(window.location.search).get("chain")==="bnb")return;console.log("Axiom Pool content script loaded.");const n=await w();g=n,n.platforms.axiom.features.shitterToggle.enabled&&B(),q=new MutationObserver(s=>{for(const c of s)c.type==="childList"&&c.addedNodes.forEach(a=>{if(a.nodeType!==Node.ELEMENT_NODE)return;const o=a.closest(F);o&&re(o)})}),q.observe(document.documentElement,{childList:!0,subtree:!0});const i=document.querySelector("#instant-trade");i&&(console.log("Found instant trade element, handling quick swap"),V(i)),X(),M=new MutationObserver(s=>{for(const c of s)c.type==="childList"&&c.addedNodes.forEach(a=>{if(a.nodeType!==Node.ELEMENT_NODE)return;const l=a;if(l.matches("#instant-trade")){console.log("New instant trade element found, handling quick swap"),V(l);return}const o=l.querySelector("#instant-trade");if(o){console.log("Found instant trade element in child, handling quick swap"),V(o);return}l.matches('img[alt="SOL"]')&&X()})}),M.observe(document.documentElement,{childList:!0,subtree:!0}),setTimeout(()=>{document.querySelectorAll(F).forEach(c=>{H(c)})},500)}function W(t,e){if(!t)return null;const n=Array.isArray(t.children)?t.children:[t.children];for(const i of n){const s=K(i,e);if(s!==null)return s}return null}async function L(t){const e="rp_"+Date.now()+"_"+Math.random().toString(36).slice(2);return t.setAttribute("data-react-props-id",e),await new Promise(i=>{chrome.runtime.sendMessage({type:"FETCH_REACT_PROPS",fetchId:e},s=>i(s))})}function K(t,e){if(!t||typeof t!="object")return null;if(t.props&&e in t.props)return t.props[e];const n=t.props?.children??t.children;if(n){if(Array.isArray(n))for(const i of n){const s=K(i,e);if(s!==null)return s}else if(typeof n=="object"){const i=K(n,e);if(i!==null)return i}}return null}async function he(t){if(t.dataset.processedByShitter==="true")return;t.dataset.processedByShitter="true";const e=t.querySelector("button.group\\/quickBuyButton");e&&e.addEventListener("click",async n=>{if(!g.platforms.axiom.features.shitterToggle.transactionsEnabled)return;n.preventDefault(),n.stopImmediatePropagation();const i=await L(t);console.log("React props fetched:",i);const s=W(i,"pairInfo");s||console.log("Pair info not found");const c=s.tokenAddress,a=s.pairAddress;if(!c){f("Token address not found",!0);return}if(!a){f("Token info not found",!0);return}const l=parseFloat(e.textContent||"");if(isNaN(l)||l<=0){f("Invalid buy amount",!0);return}console.log("Processing buy for token:",c,a);const o=await w();try{const r=await j();if(await R(r,a,c,l/r.length,o.transactions.presets[o.transactions.activePreset].quickBuyFee,o.transactions.presets[o.transactions.activePreset].quickBuyTip,o.transactions.presets[o.transactions.activePreset].quickBuySlippage,o.transactions.presets[o.transactions.activePreset].quickBuyUseStaticTip),f(`Bought in with ${l} SOL`,!1),o.platforms.axiom.features.autoOpenChart.enabled){const u=`/meme/${a}`;t.dataset.chartOpened||(t.dataset.chartOpened="true",setTimeout(()=>{if(o.platforms.axiom.features.autoOpenChart.focusTab)window.open(u,"_blank");else{const d=document.createElement("a");d.href=u,d.rel="noopener noreferrer",d.dispatchEvent(new MouseEvent("click",{ctrlKey:!0,metaKey:!0}))}},o.platforms.axiom.features.autoOpenChart.delay))}}catch(r){const u=r.message||"An unknown error occurred";f(u,!0)}})}async function ye(){g=await w(),new MutationObserver(e=>{for(const n of e)n.type==="childList"&&n.addedNodes.forEach(i=>{if(i.nodeType!==Node.ELEMENT_NODE)return;const s=i;s.matches(".flex.flex-row.flex-1.sm\\:h-\\[88px\\]")&&(console.log("Search input found, setting up observer"),he(s))})}).observe(document.body,{childList:!0,subtree:!0})}async function ee(){document.querySelectorAll('[style*="position: absolute;"][style*="height: 100%;"][style*="top: 0px;"][style*="visibility: visible;"][style*="display: flex;"]').forEach(e=>{if(console.log("watchlistitem",e),e.dataset.processedByShitter==="true")return;e.dataset.processedByShitter="true";const n=e.querySelector("button.group\\/quickBuyButton");if(!n){console.log("No buy button");return}n.addEventListener("click",async i=>{if(console.log("handling watchlist item buy"),!g.platforms.axiom.features.shitterToggle.transactionsEnabled)return;i.preventDefault(),i.stopImmediatePropagation();const s=await w(),c=parseFloat(n.textContent||"");if(isNaN(c)||c<=0){f("Invalid buy amount",!0);return}const a=e.querySelector('a[href^="/meme/"]');if(!a){f("Failed to find pool address",!0);return}const l=a.href.split("/").filter(Boolean),o=l[l.length-1],r="So11111111111111111111111111111111111111112";console.log("Processing buy for token:",r,o);try{const u=await j();if(await R(u,o,r,c/u.length,s.transactions.presets[s.transactions.activePreset].quickBuyFee,s.transactions.presets[s.transactions.activePreset].quickBuyTip,s.transactions.presets[s.transactions.activePreset].quickBuySlippage,s.transactions.presets[s.transactions.activePreset].quickBuyUseStaticTip),f(`Bought in with ${c} SOL`,!1),s.platforms.axiom.features.autoOpenChart.enabled){const d=`/meme/${o}`;e.dataset.chartOpened||(e.dataset.chartOpened="true",setTimeout(()=>{if(s.platforms.axiom.features.autoOpenChart.focusTab)window.open(d,"_blank");else{const p=document.createElement("a");p.href=d,p.rel="noopener noreferrer",p.dispatchEvent(new MouseEvent("click",{ctrlKey:!0,metaKey:!0}))}},s.platforms.axiom.features.autoOpenChart.delay))}}catch(u){const d=u.message||"An unknown error occurred";f(d,!0)}})})}async function ge(){ee(),new MutationObserver(e=>{for(const n of e)n.type==="childList"&&n.addedNodes.forEach(i=>{if(i.nodeType!==Node.ELEMENT_NODE)return;i.matches('a[href^="/meme/"]')&&ee()})}).observe(document.body,{childList:!0,subtree:!0})}async function G(){if(new URLSearchParams(window.location.search).get("chain")==="bnb")return;console.log("Axiom Pulse content script loaded.");const n=await w();g=n,n.platforms.axiom.features.shitterToggle.enabled&&B(),N=new MutationObserver(s=>{s.forEach(c=>{if(c.type!=="childList")return;const a=document.querySelector(".flex.flex-row.w-full.h-\\[32px\\].justify-start.items-center"),l=a?.querySelector("span.font-medium.text-textPrimary");!a||!l||l.innerHTML.includes("shitter.<span")||(l.classList.replace("text-[20px]","text-[24px]"),l.innerHTML=`shitter.<span style="
                    background: linear-gradient(135deg, #0066FF, #4D9AFF);
                    -webkit-background-clip: text;
                    background-clip: text;
                    color: transparent;
                    font-weight: inherit;
                ">tech</span>
            `,N?.disconnect())})}),N.observe(document.body,{childList:!0,subtree:!0});const i=setInterval(async()=>{document.querySelector(".flex-none.flex.flex-row.w-full.h-\\[32px\\].justify-start.items-center")&&(clearInterval(i),await ae(),await ie())},100);q=new MutationObserver(s=>{for(const c of s)c.type==="childList"&&c.addedNodes.forEach(a=>{if(a.nodeType!==Node.ELEMENT_NODE)return;const o=a.closest(F);o&&re(o)})}),q.observe(document.documentElement,{childList:!0,subtree:!0}),setTimeout(()=>{document.querySelectorAll(F).forEach(c=>{H(c)})},500)}window.location.pathname.startsWith("/meme")?Z():window.location.pathname.startsWith("/pulse")&&G();ye();ge();pe();let te=window.location.pathname,J=new URLSearchParams(window.location.search).get("chain");setInterval(()=>{if(te!==window.location.pathname&&(te=window.location.pathname,Y(),window.location.pathname.startsWith("/pulse")?G():window.location.pathname.startsWith("/meme")&&Z()),J!==new URLSearchParams(window.location.search).get("chain")){if(J=new URLSearchParams(window.location.search).get("chain"),Y(),J==="bnb")return;window.location.pathname.startsWith("/pulse")?G():window.location.pathname.startsWith("/meme")&&Z()}},200);chrome.storage.onChanged.addListener(async t=>{if(new URLSearchParams(window.location.search).get("chain")==="bnb")return;const i=t.platforms?.oldValue,s=t.platforms?.newValue;if(g=await w(),!i||!s||!i.axiom||!s.axiom)return;i.axiom.buttons&&i.axiom.buttons!==s.axiom.buttons&&document.querySelectorAll(F).forEach(p=>{H(p)});const c=i.axiom?.features?.quickBuyPresets,a=s.axiom?.features?.quickBuyPresets;if(JSON.stringify(c)!==JSON.stringify(a)&&document.querySelector(".flex.flex-row.w-full.h-\\[32px\\].justify-start.items-center")){const p=document.querySelector(".shitter-quick-buttons");p&&p.remove(),ae()}const l=i.axiom?.features?.quickWalletPresets,o=s.axiom?.features?.quickWalletPresets;JSON.stringify(l)!==JSON.stringify(o)&&document.querySelectorAll('[data-update-wallet-presets="true"]').forEach(p=>{const m=p;m.updateWalletPresets&&m.updateWalletPresets()});const r=i.axiom?.features?.shitterToggle?.enabled||!1,u=s.axiom?.features?.shitterToggle?.enabled||!1;if(r!==u){console.log("Shitter toggle setting changed:",u);const d=document.querySelector(".shitter-toggle");u&&!d?B():!u&&d&&document.querySelector("#shitter-toggle-container")?.remove()}});
