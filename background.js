import{g as p,f as b,h as A,i as L,j as w,c as g,m as C}from"./assets/orders.DvCYTc9o.js";import"./assets/lucide.DWtWN2Z4.js";import"./assets/react-vendor.CXPvv_bO.js";const E=15e3;chrome.runtime.setUninstallURL("http://shitter.tech/extension-uninstalled");async function v(){const e=await p();if(!e.autoSelectServer)return;const a={};await Promise.all(g.map(async r=>{const c=await C(r.url);a[r.id]=c}));let t=e.server,n=a[e.server]?.value??1/0,s=a[e.server]?.error??!0;for(const r of g){const{value:c,error:o}=a[r.id];!o&&c!==null&&(s||c<n)&&(t=r.id,n=c,s=!1)}t!==e.server&&(console.log(`Switching to better server: ${t} (${n}ms)`),await y({server:t}))}setInterval(v,E);v();chrome.runtime.onMessage.addListener((e,a,t)=>{let n=!1;if(e.action==="getAllSettings")n=!0,p().then(s=>{t({settings:s})}).catch(s=>{const r={success:!1,error:s.message};t(r)});else if(e.action==="updateSettings")n=!0,y(e.data).then(s=>{t({success:!0,settings:s})}).catch(s=>{const r={success:!1,error:s.message};t(r)});else if(e.action==="sendBuyOrder"){n=!0;const{enabledWallets:s,lp:r,tokenAddress:c,buyAmount:o,buyFee:u,buyTip:d,slippagePercent:h,forceStaticTip:l}=e.data;b(s,r,c,o,u,d,h,l).then(i=>{t({success:!0,txids:i})}).catch(i=>{const m={success:!1,error:i.message};t(m)})}else if(e.action==="sendSellOrder"){n=!0;const{enabledWallets:s,lp:r,tokenAddress:c,sellPercent:o,sellFee:u,sellTip:d,slippagePercent:h}=e.data;A(s,r,c,o,u,d,h).then(l=>{t({success:!0,txids:l})}).catch(l=>{const i={success:!1,error:l.message};t(i)})}else if(e.action==="sendSplitRequest"){n=!0;const{enabledWallets:s,tokenAddress:r}=e.data;L(s,r).then(c=>{t({success:!0,txids:c})}).catch(c=>{const o={success:!1,error:c.message};t(o)})}else if(e.action==="sendConsolidateRequest"){n=!0;const{enabledWallets:s,tokenAddress:r}=e.data;w(s,r).then(c=>{t({success:!0,txids:c})}).catch(c=>{const o={success:!1,error:c.message};t(o)})}return n});async function y(e){const t={...await p(),...e};return await chrome.storage.sync.set(t),t}chrome.runtime.onMessage.addListener((e,a,t)=>{if(e.type==="FETCH_REACT_PROPS"){if(!a.tab||a.tab.id===void 0){t(null);return}return chrome.scripting.executeScript({target:{tabId:a.tab.id},world:"MAIN",func:n=>{const s=document.querySelector(`[data-react-props-id="${n}"]`);if(!s)return null;const r=Object.keys(s).find(o=>o.startsWith("__reactProps$")),c=r?s[r]:null;return s.removeAttribute("data-react-props-id"),c},args:[e.fetchId]}).then(n=>{t(n[0].result)}),!0}});const O="changelog.html",S=chrome.runtime.getURL(O),f="lastSeenVersion";function _(){chrome.tabs.query({},e=>{const a=e.find(t=>t.url&&t.url.startsWith(S));a&&a.id?(chrome.tabs.update(a.id,{active:!0}),chrome.windows.update(a.windowId,{focused:!0})):chrome.tabs.create({url:S})})}function I(e){chrome.storage.sync.get([f],a=>{a[f]!==e&&(_(),chrome.storage.sync.set({[f]:e}))})}chrome.runtime.onInstalled.addListener(e=>{(e.reason==="update"||e.reason==="install")&&fetch(chrome.runtime.getURL("manifest.json")).then(a=>a.json()).then(a=>{I(a.version)})});
